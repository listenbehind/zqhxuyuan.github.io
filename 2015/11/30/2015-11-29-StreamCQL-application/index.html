	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>StreamCQLæºç é˜…è¯»(4) åº”ç”¨ç¨‹åºæ‰§è¡Œ | ä»»ä½•å¿§ä¼¤,éƒ½æŠµä¸è¿‡ä¸–ç•Œçš„ç¾ä¸½</title>
  <meta name="author" content="zqhxuyuan">
  
  <meta name="description" content="submitApplicationå†ç»åƒè¾›ä¸‡è‹¦, ç»ˆäºå›åˆ°SubmitTaskçš„submitApplication, åˆ›å»ºç‰©ç†è®¡åˆ’Executor,å¹¶æ‰§è¡ŒApplication.  
123private void submitApplication() &amp;#123;    new Physical">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="StreamCQLæºç é˜…è¯»(4) åº”ç”¨ç¨‹åºæ‰§è¡Œ"/>
  <meta property="og:site_name" content="ä»»ä½•å¿§ä¼¤,éƒ½æŠµä¸è¿‡ä¸–ç•Œçš„ç¾ä¸½"/>

  
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <!-- ç™¾åº¦ç»Ÿè®¡ -->
  

  <!-- è°·æ­Œç»Ÿè®¡ -->
  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">èœå•</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">ä»»ä½•å¿§ä¼¤,éƒ½æŠµä¸è¿‡ä¸–ç•Œçš„ç¾ä¸½</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>é¦–é¡µ
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>å­˜æ¡£
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	<div class="col-md-8">
	  <!-- index -->
	  
			<h1>StreamCQLæºç é˜…è¯»(4) åº”ç”¨ç¨‹åºæ‰§è¡Œ</h1>
			
			<div>
				<i class="fa fa-clock-o"></i>
				<span class="post-time">2015-11-30 09:22:33</span>
			</div>
			
	  

		<div class="content">
			<!-- index -->
		  
					<h2 id="submitApplication">submitApplication</h2><p>å†ç»åƒè¾›ä¸‡è‹¦, ç»ˆäºå›åˆ°SubmitTaskçš„submitApplication, åˆ›å»ºç‰©ç†è®¡åˆ’Executor,å¹¶æ‰§è¡ŒApplication.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">submitApplication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> PhysicalPlanExecutor().execute(context.getApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="api-Application_-&gt;_application-Application">api.Application -&gt; application.Application</h3><p>apiçš„Applicationæ˜¯æµå¤„ç†æ‰§è¡Œè®¡åˆ’åº”ç”¨ç¨‹åº, å°è£…çš„æ˜¯CQLè¯­å¥æ„å»ºè€Œæˆçš„åº”ç”¨ç¨‹åº:  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;                      </span><br><span class="line">    <span class="keyword">private</span> String applicationId = <span class="keyword">null</span>;                    <span class="comment">//åº”ç”¨id</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName = <span class="keyword">null</span>;                  <span class="comment">//åº”ç”¨åç§°</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;String, String&gt; confs;                  <span class="comment">//æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ç”¨åˆ°çš„é…ç½®å±æ€§,ä¹ŸåŒ…å«ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String[] userFiles;                             <span class="comment">//ç”¨æˆ·è‡ªå®šä¹‰æ·»åŠ çš„ä¸€äº›æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserFunction&gt; userFunctions;               <span class="comment">//ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°,udfå’Œudaféƒ½åœ¨è¿™ä¸ªé‡Œé¢</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Schema&gt; schemas = <span class="keyword">new</span> ArrayList&lt;Schema&gt;(); <span class="comment">//æ‰§è¡Œè®¡åˆ’ä¸­çš„æ‰€æœ‰çš„schema</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Operator&gt; operators = <span class="keyword">null</span>;                <span class="comment">//æ‰§è¡Œè®¡åˆ’ä¸­æ‰€æœ‰çš„æ“ä½œ,åŒ…å«è¾“å…¥ã€è¾“å‡ºå’Œè®¡ç®—æ“ä½œ      </span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OperatorTransition&gt; opTransition = <span class="keyword">null</span>;   <span class="comment">//æ•´ä¸ªæ‰§è¡Œè®¡åˆ’ä¸­æ‰€æœ‰çš„è¿æ¥çº¿ï¼Œå®šä¹‰äº†operatorä¹‹é—´çš„è¿æ¥å…³ç³»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿˜è®°å¾—ä¸Šä¸€ç¯‡ä¸­åœ¨buildApplicationæ—¶,ç”±SplitContextæ‹†åˆ†ç®—å­,ç»„åˆç®—å­ä¼šæŠŠoperatorså’Œtransitionséƒ½è®¾ç½®åˆ°Applicationé‡Œå—?  </p>
</blockquote>
<p>application.Applicationé’ˆå¯¹Schemaå’ŒOperatoré‡‡ç”¨Managerç®¡ç†ç±»(å®é™…ä¸Šåº•å±‚çš„å­˜å‚¨ç»“æ„éƒ½æ˜¯Map)æ¥æ“ä½œ:  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String appName;                 <span class="comment">//åº”ç”¨ç¨‹åºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> EventTypeMng streamSchema;      <span class="comment">//æ‰€æœ‰Schemaé›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> OperatorMng operatorManager;    <span class="comment">//ç®—å­é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> StreamingConfig conf;           <span class="comment">//ç³»ç»Ÿçº§åˆ«çš„é…ç½®å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OperatorMngç®¡ç†çš„ç®—å­åŒ…æ‹¬è¾“å…¥ç®—å­(addInputStream),è¾“å‡ºç®—å­(addOutputStream),åŠŸèƒ½ç®—å­(addFunctionStream).  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IRichOperator (com.huawei.streaming.operator)</span><br><span class="line">    |-- AbsOperator </span><br><span class="line">        |-- FunctionOperator        <span class="comment">//åŠŸèƒ½ç®—å­</span></span><br><span class="line">            |-- JoinFunctionOp </span><br><span class="line">                |-- DataSourceFunctionOp </span><br><span class="line">            |-- AggFunctionOp </span><br><span class="line">            |-- SplitOp </span><br><span class="line">            |-- UnionFunctionOp </span><br><span class="line">            |-- SelfJoinFunctionOp </span><br><span class="line">            |-- FunctorOp </span><br><span class="line">            |-- FilterFunctionOp </span><br><span class="line">        |-- OutputOperator          <span class="comment">//è¾“å‡ºç®—å­</span></span><br><span class="line">        |-- FunctionStreamOperator </span><br><span class="line">        |-- InputOperator           <span class="comment">//è¾“å…¥ç®—å­</span></span><br></pre></td></tr></table></figure>
<p>IRichOperatoræµå¤„ç†ç®—å­åŸºæœ¬æ¥å£: æ‰€æœ‰çš„æµå¤„ç†ç›¸å…³çš„ç®—å­å®ç°ï¼Œéƒ½æ¥æºäºè¿™ä¸ªç®—å­, æ‰€æœ‰çš„å¤–éƒ¨Stormå®ç°å‡ä¾èµ–äºè¿™ä¸ªæ¥å£  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRichOperator</span> <span class="keyword">extends</span> <span class="title">IOperator</span>, <span class="title">Configurable</span></span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getOperatorId</span><span class="params">()</span></span>;                     <span class="comment">//è·å–ç®—å­id</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getParallelNumber</span><span class="params">()</span></span>;                    <span class="comment">//è·å–ç®—å­å¹¶å‘åº¦</span></span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">getInputStream</span><span class="params">()</span></span>;              <span class="comment">//è·å–è¾“å…¥æµåç§°, å¤šä¸ªè¾“å…¥æµ</span></span><br><span class="line">    <span class="function">String <span class="title">getOutputStream</span><span class="params">()</span></span>;                   <span class="comment">//è·å–è¾“å‡ºæµåç§°</span></span><br><span class="line">    Map&lt;String, IEventType&gt; getInputSchema();   <span class="comment">//è·å–è¾“å…¥schema, &lt;keyæ˜¯è¾“å…¥æµåç§°,IEventTypeæ˜¯è¾“å…¥æµçš„Schema&gt;</span></span><br><span class="line">    <span class="function">IEventType <span class="title">getOutputSchema</span><span class="params">()</span></span>;               <span class="comment">//è·å–è¾“å‡ºschema</span></span><br><span class="line">    Map&lt;String, GroupInfo&gt; getGroupInfo();      <span class="comment">//è·å–åˆ†ç»„ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿˜è®°å¾—ä¸Šä¸€ç« åœ¨åˆ›å»ºTransitionæ—¶ä¼šæŒ‡å®šåˆ†ç»„å­—æ®µå’Œåˆ†ç»„ç­–ç•¥å—? è™½ç„¶é‚£æ—¶å€™çš„ç®—å­XXXOperatorå’Œè¿™é‡Œçš„XXXOpæœ‰ç‚¹å·®åˆ«,ä½†æ€»å½’æ˜¯ä¼šæœ‰è¡€ç¼˜å…³ç³»çš„.  </p>
</blockquote>
<p>é€šè¿‡ExecutorPlanGeneratorç”Ÿæˆçš„application.Applicationåˆ™æ˜¯ç”Ÿæˆå¯æ‰§è¡Œçš„æ‰§è¡Œè®¡åˆ’. å¯æ‰§è¡ŒæŒ‡çš„æ˜¯å¯ä»¥è¿è¡Œåœ¨Stormå¼•æ“.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Application apiApplication)</span> </span>&#123;</span><br><span class="line">    parseUserDefineds(apiApplication, isStartFromDriver);   <span class="comment">//â‘ å‡†å¤‡å·¥ä½œ</span></span><br><span class="line">    com.huawei.streaming.application.Application app = generatorPlan(apiApplication);</span><br><span class="line">    submit(app);                    <span class="comment">//â‘£ æäº¤Application</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç”±ç‰©ç†æ‰§è¡Œè®¡åˆ’api.Applicationç”Ÿæˆå¯æ‰§è¡Œè®¡åˆ’application.Application(æœ€ç»ˆç”Ÿæˆçš„ï¼Œå¯ä»¥æäº¤çš„åº”ç”¨ç¨‹åº)</span></span><br><span class="line"><span class="keyword">private</span> com.huawei.streaming.application.<span class="function">Application <span class="title">generatorPlan</span><span class="params">(Application apiApplication)</span> </span>&#123;</span><br><span class="line">    preExecute(apiApplication);     <span class="comment">//æ‰§è¡Œå™¨æ‰§è¡Œä¹‹å‰çš„é’©å­</span></span><br><span class="line">    <span class="keyword">new</span> PhysicPlanChecker().check(apiApplication);</span><br><span class="line">    <span class="comment">//â‘¡ ç”¨æˆ·è‡ªå®šä¹‰çš„å¤„ç†: æ‰§è¡Œè®¡åˆ’çš„ç»„è£…, æ„å»ºapplication, è¡¨è¾¾å¼çš„è§£æè¢«å»¶è¿Ÿåˆ°è¿™é‡Œæ¥å®ç°</span></span><br><span class="line">    com.huawei.streaming.application.Application app = generator.generate(apiApplication);  </span><br><span class="line">    preSubmit(app);                 <span class="comment">//æäº¤æ‰§è¡Œè®¡åˆ’ä¹‹å‰çš„é’©å­</span></span><br><span class="line">    executorChecker.check(app);     <span class="comment">//â‘¢ æ‰§è¡Œè®¡åˆ’æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç”Ÿæˆå¯æ‰§è¡Œè®¡åˆ’ä¹‹å‰â‘ <code>parseUserDefineds</code>è®¾ç½®ä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰çš„å‡†å¤‡å·¥ä½œ:æ¯”å¦‚æ³¨å†ŒjaråŒ…,æ³¨å†Œå‡½æ•°,æ‰“åŒ…ç­‰(ç±»ä¼¼stormä¸­éœ€è¦ä¸Šä¼ jaråŒ…çš„å‡†å¤‡å·¥ä½œ).    </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-11-25 02:32:24 | INFO  | [main] | &#128073; start to execute application example | com.huawei.streaming.cql.executor.PhysicalPlanExecutor (PhysicalPlanExecutor.java:127)&#10;2015-11-25 02:32:25 | INFO  | [main] | start to unzip jar stream-storm-1.0-jar-with-dependencies.jar | com.huawei.streaming.cql.executor.mergeuserdefinds.JarExpander (JarExpander.java:79)&#10;2015-11-25 02:32:25 | INFO  | [main] | unzip jar /private/var/folders/xc/x0b8crk9667ddh1zhfs29_zr0000gn/T/da6d53114b1f49458c0e6329553b1ff9/stream-storm-1.0-jar-with-dependencies.jar to /private/var/folders/xc/x0b8crk9667ddh1zhfs29_zr0000gn/T/da6d53114b1f49458c0e6329553b1ff9/jartmp | com.huawei.streaming.cql.executor.mergeuserdefinds.JarExpander (JarExpander.java:91)&#10;2015-11-25 02:32:30 | INFO  | [main] | finished to unzip jar to dir | com.huawei.streaming.cql.executor.mergeuserdefinds.JarExpander (JarExpander.java:84)&#10;2015-11-25 02:32:30 | INFO  | [main] | start to copy ch | com.huawei.streaming.cql.executor.mergeuserdefinds.JarFilesMerger (JarFilesMerger.java:82)&#10;...&#10;2015-11-25 02:32:38 | INFO  | [main] | finished to package jar | com.huawei.streaming.cql.executor.mergeuserdefinds.JarPacker (JarPacker.java:68)</span><br></pre></td></tr></table></figure>
<h3 id="Schema_-&gt;_TupleEventType">Schema -&gt; TupleEventType</h3><p>åœ¨ç¬¬ä¸€ç¯‡ä¸­Topologyçš„CQLè¯­å¥:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">INPUT</span> STREAM s(<span class="keyword">id</span> <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="keyword">STRING</span>, <span class="keyword">type</span> <span class="built_in">INT</span>) <span class="keyword">SOURCE</span> randomgen PROPERTIES ( timeUnit = <span class="string">"SECONDS"</span>, <span class="keyword">period</span> = <span class="string">"1"</span>, eventNumPerperiod = <span class="string">"1"</span>, isSchedule = <span class="string">"true"</span> );</span></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">OUTPUT</span> STREAM rs(<span class="keyword">type</span> <span class="built_in">INT</span>, cc <span class="built_in">INT</span>) SINK consoleOutput;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> STREAM rs <span class="keyword">SELECT</span> <span class="keyword">type</span>, <span class="keyword">COUNT</span>(<span class="keyword">id</span>) <span class="keyword">as</span> cc</span><br><span class="line"><span class="keyword">FROM</span> s[<span class="keyword">RANGE</span> <span class="number">20</span> SECONDS BATCH]</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">5</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">type</span>;</span></span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆå¯æ‰§è¡Œè®¡åˆ’å¯¹åº”çš„æ—¥å¿—, ä¼šè§£æschemaå’Œç®—å­.   </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | ğŸ‘‰ start to generator executor application <span class="keyword">for</span> app example | com.huawei.streaming.cql.executor.ExecutorPlanGenerator (ExecutorPlanGenerator.java:<span class="number">102</span>)</span><br><span class="line"></span><br><span class="line">è§£æschemasæ—¶, æ·»åŠ è¾“å…¥å’Œè¾“å‡ºçš„Schema, è½¬æ¢æˆEventType.  </span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | AddEventType enter, the eventtypeName is:s. | com.huawei.streaming.event.EventTypeMng (EventTypeMng.java:<span class="number">73</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | AddEventType enter, the eventtypeName is:rs. | com.huawei.streaming.event.EventTypeMng (EventTypeMng.java:<span class="number">73</span>)</span><br><span class="line"></span><br><span class="line">è§£æç®—å­: <span class="number">1</span>)è§£æäºŒå…ƒè¡¨è¾¾å¼(å±æ€§å€¼è¡¨è¾¾å¼) id &gt; <span class="number">5</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to parse cql : (s.id &gt; <span class="number">5</span>) | com.huawei.streaming.cql.semanticanalyzer.parser.ApplicationParser (ApplicationParser.java:<span class="number">44</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Parse Completed | com.huawei.streaming.cql.semanticanalyzer.parser.ApplicationParser (ApplicationParser.java:<span class="number">69</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to create binary Expressions. | com.huawei.streaming.cql.executor.expressioncreater.PropertyValueExpressionCreator (BinaryExpressionCreator.java:<span class="number">54</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Parse Completed, cql : s.type,  count( s.id )  | com.huawei.streaming.cql.semanticanalyzer.parser.SelectClauseParser (SelectClauseParser.java:<span class="number">68</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)è§£æ group by</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to parse cql : s.type | com.huawei.streaming.cql.semanticanalyzer.parser.GroupbyClauseParser (GroupbyClauseParser.java:<span class="number">45</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Parse Completed | com.huawei.streaming.cql.semanticanalyzer.parser.GroupbyClauseParser (GroupbyClauseParser.java:<span class="number">68</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to parse cql : s.type | com.huawei.streaming.cql.semanticanalyzer.parser.GroupbyClauseParser (GroupbyClauseParser.java:<span class="number">45</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Parse Completed | com.huawei.streaming.cql.semanticanalyzer.parser.GroupbyClauseParser (GroupbyClauseParser.java:<span class="number">68</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>)èšåˆç®—å­ count(id)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to create aggregate service | com.huawei.streaming.cql.executor.operatorviewscreater.AggregateServiceViewCreator (AggregateServiceViewCreator.java:<span class="number">89</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‰é¢åœ¨submitä¹‹å‰å·²ç»start to parse cqlè¿‡ä¸€æ¬¡äº†,è¿™é‡Œä¸ºä»€ä¹ˆè¿˜ä¼šå†æ¬¡parse?<br>ç­”: å‰é¢åªæ˜¯LazyTaskæ‡’è§£æ,å…¶å®è¿˜æ˜¯æ²¡æœ‰å¼€å§‹çš„. é‚£ä¸ºä»€ä¹ˆè¦åœ¨è¿™é‡Œæ‰å¼€å§‹? å› ä¸ºè§£æå®Œschemaå, å°±è¯¥è½®åˆ°operatorçš„è§£æäº†.   </p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ApplicationParser.<span class="function"><span class="title">parse</span><span class="params">(String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.semanticanalyzer</span><span class="class">.parser</span>)</span><br><span class="line">    OrderByViewCreator.<span class="function"><span class="title">analyzeOrderByExpression</span><span class="params">(List&lt;Schema&gt;, String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.executor</span><span class="class">.operatorviewscreater</span>)</span><br><span class="line">    DataSourceInfoOperatorCreator.<span class="function"><span class="title">dataSourceQueryArguments</span><span class="params">()</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.executor</span><span class="class">.operatorinfocreater</span>)</span><br><span class="line">    SelectWithOutFromAnalyzer.<span class="function"><span class="title">createSelectExpression</span><span class="params">(IParser, Column)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.semanticanalyzer</span>)</span><br><span class="line">    SelectViewExpressionCreator.<span class="function"><span class="title">analzyeSelectExpressions</span><span class="params">(List&lt;Schema&gt;, String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.executor</span><span class="class">.operatorviewscreater</span>)</span><br><span class="line">    SelectStatementAnalyzer.<span class="function"><span class="title">createSelectExpression</span><span class="params">(IParser, Column)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.semanticanalyzer</span>)</span><br><span class="line">    Driver.<span class="function"><span class="title">run</span><span class="params">(String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span>)</span><br><span class="line">    AggregateConverter.<span class="function"><span class="title">isHasAggregate</span><span class="params">(String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.builder</span><span class="class">.physicoptimizer</span>)</span><br><span class="line">    GroupByViewCreator.<span class="function"><span class="title">analyzeGroupByExpressions</span><span class="params">(List&lt;Schema&gt;, String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.executor</span><span class="class">.operatorviewscreater</span>)</span><br><span class="line">    FilterViewExpressionCreator.<span class="function"><span class="title">analzyeFilterExpression</span><span class="params">(List&lt;Schema&gt;, String)</span></span>  (com<span class="class">.huawei</span><span class="class">.streaming</span><span class="class">.cql</span><span class="class">.executor</span><span class="class">.operatorviewscreater</span>)</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„å¯æ‰§è¡Œè®¡åˆ’ä¼šè§£æApplicationä¸­çš„Schemaå’ŒOperators,ç»è¿‡é‡æ–°ç»„è£…,è®¾ç½®åˆ°å¯æ‰§è¡Œçš„Applicationä¸­.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> com.huawei.streaming.application.<span class="function">Application <span class="title">generate</span><span class="params">(Application vap)</span> </span>&#123;</span><br><span class="line">    LOG.info(<span class="string">"start to generator executor application for app "</span> + vap.getApplicationId());</span><br><span class="line">    apiApplication = vap;</span><br><span class="line">    createEmptyApplication(vap.getApplicationId());</span><br><span class="line">    parseUserDefineds(vap);     <span class="comment">//ç”¨æˆ·è‡ªå®šä¹‰çš„å¤„ç†</span></span><br><span class="line">    parseSchemas();             <span class="comment">//è§£ææ‰€æœ‰çš„Schemaï¼Œæ„å»ºschemaä¿¡æ¯</span></span><br><span class="line">    parseOperators();           <span class="comment">//è§£ææ‰€æœ‰çš„Operator,æ„å»ºOperatorInfo. æ•´ç†Operatorä¸­çš„ä¸Šä¸‹çº§å…³ç³»</span></span><br><span class="line">    <span class="keyword">return</span> executorApp;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æSchemaä¼šå°†Schemaè½¬æ¢ä¸ºIEventäº‹ä»¶: TupleEventType. Schemaä¸­çš„Columnä¼šè½¬æ¢ä¸ºTupleEventTypeçš„Attribute.è€ŒschemaNameä»ç„¶ä¸å˜.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TupleEventType</span> <span class="keyword">implements</span> <span class="title">IEventType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;            <span class="comment">//schemaName,è¡¨å</span></span><br><span class="line">    <span class="keyword">private</span> Attribute[] schema;     <span class="comment">//schemas, æ‰€æœ‰åˆ—</span></span><br><span class="line">    <span class="keyword">private</span> String[] attNames;      <span class="comment">//æ‰€æœ‰åˆ—çš„åˆ—å</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt; ? &gt;[] attTypes;  <span class="comment">//æ‰€æœ‰åˆ—çš„åˆ—ç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String, Integer&gt; attid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Schemaçš„ç®¡ç†ç±»ç”¨Mapç»“æ„ä¿å­˜schemaName/eventTypeNameå’Œå¯¹åº”çš„Schema/TupleEventType: è¡¨å-&gt;è¡¨ç»“æ„.   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventTypeMng</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IEventType&gt; schemas;            <span class="comment">//MAP: æ•°æ®ç±»å‹åç§° =&gt; å…·ä½“æ•°æ®ç±»å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEventType</span><span class="params">(IEventType schema)</span> </span>&#123;</span><br><span class="line">        schemas.put(schema.getEventTypeName(), schema); <span class="comment">//æ•°æ®ç±»å‹|äº‹ä»¶ç±»å‹|è¡¨åschemaName|streamNameæµåç§°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ç®—å­ç®¡ç†OperatorMngåˆ™ç”¨ä¸‰ä¸ªMapåˆ†åˆ«ç®¡ç†è¾“å…¥,è¾“å‡º,åŠŸèƒ½ç®—å­. Mapçš„keyæ˜¯operatorId,valueæ˜¯Operatorç®—å­æœ¬èº«.   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperatorMng</span></span>&#123;    </span><br><span class="line">    <span class="keyword">private</span> List&lt;IRichOperator&gt; sortedFunctions;    <span class="comment">//DFGæ’åºåçš„åŠŸèƒ½ç®—å­åˆ—è¡¨ï¼Œä½œä¸ºåˆ›å»ºStormæ‹“æ‰‘é¡ºåºçš„åŸºç¡€(è¾“å‡ºå’ŒåŠŸèƒ½ç®—å­ç»„æˆ--&gt;Bolt)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IRichOperator&gt; inputs;      <span class="comment">//è¾“å…¥ç®—å­ --&gt; Spout</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IRichOperator&gt; functions;   <span class="comment">//åŠŸèƒ½ç®—å­</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IRichOperator&gt; outputs;     <span class="comment">//è¾“å‡ºç®—å­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç®—å­è§£æ">ç®—å­è§£æ</h3><p>ç®—å­è§£æ: è¿™é‡Œçš„è§£ææ˜¯ä¸ºäº†ä½¿å¾—è¾“å…¥å’Œè¾“å‡ºç®—å­ç»Ÿä¸€ï¼Œé¿å…ç”¨æˆ·è‡ªå®šä¹‰å’Œç³»ç»Ÿå†…ç½®çš„ç®—å­å¯¹å¤–è¡¨ç°ä¸ä¸€è‡´å¤„ç†èµ·æ¥çš„éº»çƒ¦<br>ç”±äºè¾“å…¥å’Œè¾“å‡ºç®—å­ä¸­å­˜åœ¨ç‰¹ä¾‹ï¼Œå³é’ˆå¯¹æ–‡ä»¶ï¼Œtcpï¼Œkafkaç­‰ç¼–å†™äº†ç‰¹ä¾‹, æ‰€ä»¥éœ€è¦é¦–å…ˆå°†ä»–ä»¬æŠ½è±¡åŒ–ï¼Œä¹‹åå†æ¥å¤„ç†  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseOperators</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Map&lt;String, Operator&gt; opts = formatOperators();                     <span class="comment">//â‘  è¾“å…¥è¾“å‡ºç®—å­æŠ½è±¡åŒ–</span></span><br><span class="line">    Map&lt;String, AbsOperator&gt; opMappings = createOperatorInfos(opts);    <span class="comment">//â‘¡ ç®—å­ è§£æ</span></span><br><span class="line">    combineOperators(opMappings);                                       <span class="comment">//â‘¢ æ•´ç†ç®—å­é¡ºåº</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;String, AbsOperator&gt; et : opMappings.entrySet())&#123;        <span class="comment">//â‘£ æ·»åŠ ç®—å­åˆ°Application</span></span><br><span class="line">        IRichOperator operator = et.getValue();</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œä¹Ÿç®—æ˜¯input</span></span><br><span class="line">        <span class="keyword">if</span> (operator <span class="keyword">instanceof</span> InputOperator)&#123;</span><br><span class="line">            executorApp.addInputStream(operator);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œä¹Ÿç®—æ˜¯output</span></span><br><span class="line">        <span class="keyword">if</span> (operator <span class="keyword">instanceof</span> OutputOperator)&#123;</span><br><span class="line">            executorApp.addOutputStream(operator);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä¸æ˜¯è¾“å…¥è¾“å‡º,å°±æ˜¯åŠŸèƒ½ç®—å­</span></span><br><span class="line">        executorApp.addFunctionStream(operator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Operatoræ˜¯ç®—å­, AbsOperatoråˆ™æ˜¯æµå¤„ç†ç®—å­(ç»§æ‰¿IRichOperator). å®ƒä»¬çš„è½¬æ¢ç”±OperatorInfoCreatorFactory.buildStreamOperatorå®Œæˆ.   </p>
<p><img src="http://img.blog.csdn.net/20151127114702874" alt="stream-aboperators"></p>
<p>combineOperatorsä¼šå°†ç®—å­ç”¨OperatorTransitionè¿›è¡Œè¿æ¥: æ¢³ç†operatorInfoä¹‹é—´çš„ä¸Šä¸‹çº§å…³ç³»  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">combineOperators</span><span class="params">(Map&lt;String, AbsOperator&gt; operatorInfos)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç®—å­ä¹‹é—´çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">for</span> (OperatorTransition ot : apiApplication.getOpTransition()) &#123;</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥çš„å…¥å£å’Œå‡ºå£ç®—å­</span></span><br><span class="line">        String fromOpId = ot.getFromOperatorId();</span><br><span class="line">        String toOpId = ot.getToOperatorId();</span><br><span class="line">        String streamName = ot.getStreamName();</span><br><span class="line">        DistributeType distributedType = ot.getDistributedType();</span><br><span class="line">        String distributedFields = ot.getDistributedFields();</span><br><span class="line">        <span class="comment">//è¿æ¥çš„Schema, å¯¹äºFromå’ŒToéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„Schema</span></span><br><span class="line">        String outputSchemaName = ot.getSchemaName();</span><br><span class="line">        distributedFields = ExecutorUtils.removeStreamName(distributedFields);            </span><br><span class="line">        TupleEventType outputSchema = (TupleEventType)(executorApp.getEventType(outputSchemaName));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//operatorInfosæ˜¯æ‰€æœ‰çš„ç®—å­é›†åˆ, æ ¹æ®ä¼ å…¥çš„fromOpIdæˆ–è€…toOpId,ä»é›†åˆä¸­æ‰¾å‡ºå¯¹åº”çš„ç®—å­</span></span><br><span class="line">        combineFromTransition(operatorInfos, fromOpId, streamName, outputSchema);</span><br><span class="line">        combineToTransition(operatorInfos, toOpId, streamName, distributedType, distributedFields, outputSchema);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>FromTransition: è¿çº¿çš„fromç®—å­çš„è¾“å‡ºæ˜¯outputSchema  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">combineFromTransition</span><span class="params">(Map&lt;String, AbsOperator&gt; operatorInfos, String fromOpId, String streamName, TupleEventType outputSchema)</span></span>&#123;</span><br><span class="line">    sConfig.put(StreamingConfig.STREAMING_INNER_OUTPUT_SCHEMA, outputSchema);</span><br><span class="line">    sConfig.put(StreamingConfig.STREAMING_INNER_OUTPUT_STREAM_NAME, streamName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ToTransition: è¿çº¿çš„toç®—å­çš„è¾“å…¥æ˜¯outputSchema. <code>è¿™é‡ŒoutputSchemaå‘½åä¸ºschemaä¼¼ä¹æ›´å¥½</code>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">combineToTransition</span><span class="params">(Map&lt;String, AbsOperator&gt; operatorInfos, String toOpId, String streamName,</span><br><span class="line">    DistributeType distributedType, String distributedFields, TupleEventType outputSchema)</span> </span>&#123;</span><br><span class="line">    sConfig.put(StreamingConfig.STREAMING_INNER_INPUT_STREAM_NAME, streamName);</span><br><span class="line">    sConfig.put(StreamingConfig.STREAMING_INNER_INPUT_SCHEMA, outputSchema);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼äºGraphä¸­çš„é¡¶ç‚¹A -&gt; è¾¹ -&gt; é¡¶ç‚¹B. Transitionå°±ç±»ä¼¼äºè¾¹, è¿æ¥ç€å·¦å³ä¸¤è¾¹çš„ç®—å­, åˆ†åˆ«æ˜¯Fromç®—å­å’ŒToç®—å­.  </p>
<h2 id="SubmitApplication_-&gt;_launch_Application">SubmitApplication -&gt; launch Application</h2><p>SubmitTask.submitApplication -&gt; PhysicalPlanExecutor.execute -&gt; PhysicalPlanExecutor.submit(application.Application) -&gt;<br>StormApplication.launch -&gt; createTopology åˆ›å»ºæ‹“æ‰‘, å¯¹äºStormçš„ç¨‹åºè€Œè¨€, æ„æˆæ‹“æ‰‘çš„ç»„ä»¶åŒ…æ‹¬Spoutså’ŒBolts.<br>è¿™äº›æ•°æ®éƒ½æ¥è‡ªäºApplicationçš„è¾“å…¥,è¾“å‡ºå’ŒåŠŸèƒ½ç®—å­. ç”±äºStormåªæœ‰ä¸¤ç§ç»„ä»¶Spoutå’ŒBolt, æ‰€ä»¥è¾“å…¥ç®—å­å½’äºSpout,è¾“å‡ºå’ŒåŠŸèƒ½ç®—å­éƒ½å±äºBolt.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createSpouts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt; ? extends IRichOperator&gt; sources = getInputStreams(); <span class="comment">//è·å¾—æ‰€æœ‰æºç®—å­ä¿¡æ¯: OperatorMng.inputs</span></span><br><span class="line">    checkInputStreams(sources);</span><br><span class="line">    <span class="keyword">for</span> (IRichOperator input : sources) &#123;</span><br><span class="line">        StormSpout spout = <span class="keyword">new</span> StormSpout();</span><br><span class="line">        spout.setOperator(input);</span><br><span class="line">        builder.setSpout(input.getOperatorId(), spout, input.getParallelNumber());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createBolts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;IRichOperator&gt; orderedFunOp = genFunctionOpsOrder();   <span class="comment">//è·å–å·²ç»æ’å¥½åºçš„åŠŸèƒ½ç®—å­ï¼Œè¿™ä¸ªåŠŸèƒ½ç®—å­åŒ…å«outputç®—å­</span></span><br><span class="line">    <span class="keyword">for</span> (IRichOperator operator : orderedFunOp) &#123;</span><br><span class="line">        setOperatorGrouping(operator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å“ªäº›Operatorç®—å­ä¼šä½œä¸ºBolt, OutpoutBolt, Spoutéƒ½æ˜¯ç”±OperatorMngç®¡ç†çš„æ¯”å¦‚getInputStreams,genFunctionOpsOrder<br>è¿™æ ·åˆ›å»ºçš„Boltä¼šç›´æ¥ä¾èµ–äºå¯¹åº”çš„Operator, åœ¨å¤„ç†Boltæ—¶,å°±ä¸éœ€è¦å†åˆ¤æ–­æ˜¯å“ªä¸€ç§ç±»å‹çš„Operatoräº†.<br>æ‰€ä»¥æ­£æ˜¯ç”±äºå¯¹ç®—å­çš„ç§ç±»è¿›è¡Œäº†åˆ†ç¦»(è¾“å…¥,è¾“å‡º,åŠŸèƒ½)æ‰ä½¿å¾—å¤„ç†Stormçš„componentæ—¶å˜å¾—å®¹æ˜“.  </p>
</blockquote>
<h3 id="Bolt_Grouping">Bolt Grouping</h3><p>åœ¨å¼€å‘Stormåº”ç”¨ç¨‹åºæ—¶, ä¸€èˆ¬æ˜¯åœ¨Stormçš„Topologyä»£ç ä¸­åˆ›å»ºBoltå¹¶ç›´æ¥è®¾ç½®Boltçš„åˆ†ç»„ç­–ç•¥.<br>å‡è®¾æœ‰è¿™æ ·çš„Topology, Bolt1è¾“å‡ºåˆ°Bolt3å’ŒBolt4, Bolt2è¾“å‡ºåˆ°Bolt3(ä¸€ä¸ªBoltå¯ä»¥æœ‰å¤šä¸ªè¾“å‡º,ä¹Ÿå¯ä»¥ç”±å¤šä¸ªè¾“å…¥).    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">             |------ |Bolt4|</span><br><span class="line">|Bolt1| -----|</span><br><span class="line">             |------ |Bolt3|</span><br><span class="line">|Bolt2| -----|</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bolt1æœ‰ä¸¤ä¸ªè¾“å‡ºæµ, è¾“å‡ºå­—æ®µéƒ½æ˜¯ä¸€æ ·çš„, ä¸¤ä¸ªè¾“å‡ºæµçš„åç§°stream-idä¸ä¸€æ ·</span></span><br><span class="line">builder.setBolt(<span class="string">"bolt1"</span>, <span class="keyword">new</span> Bolt1(), <span class="number">2</span>)        </span><br><span class="line">            declarer.declareStream(<span class="string">"streamA"</span>, <span class="keyword">new</span> Fields(<span class="string">"f1"</span>,<span class="string">"f2"</span>))</span><br><span class="line">            declarer.declareStream(<span class="string">"streamB"</span>, <span class="keyword">new</span> Fields(<span class="string">"f1"</span>,<span class="string">"f2"</span>))</span><br><span class="line"><span class="comment">//Bolt2åªæœ‰ä¸€ä¸ªè¾“å‡ºæµ</span></span><br><span class="line">builder.setBolt(<span class="string">"bolt2"</span>, <span class="keyword">new</span> Bolt2(), <span class="number">2</span>)</span><br><span class="line">            declarer.declareStream(<span class="string">"streamC"</span>, <span class="keyword">new</span> Fields(<span class="string">"f1"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bolt3æ¥æ”¶Bolt1çš„streamAæµä½¿ç”¨å­—æ®µåˆ†ç»„, æ¥æ”¶Bolt2çš„streamCæµä½¿ç”¨shuffleåˆ†ç»„</span></span><br><span class="line">builder.setBolt(<span class="string">"bolt3"</span>, <span class="keyword">new</span> Bolt3(), <span class="number">4</span>)</span><br><span class="line">        .fieldsGrouping(<span class="string">"bolt1"</span>, <span class="string">"streamA"</span>, <span class="keyword">new</span> Field(<span class="string">"f1"</span>))</span><br><span class="line">        .shuffleGrouping(<span class="string">"bolt2"</span>, <span class="string">"streamC"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bolt4æ¥æ”¶Bolt1çš„streamBæµä½¿ç”¨å­—æ®µåˆ†ç»„, åˆ†ç»„å­—æ®µæ˜¯Bolt1äº§ç”Ÿçš„f2å­—æ®µ.  </span></span><br><span class="line">builder.setBolt(<span class="string">"bolt4"</span>, <span class="keyword">new</span> Bolt4(), <span class="number">3</span>)</span><br><span class="line">        .fieldsGrouping(<span class="string">"bolt1"</span>, <span class="string">"streamB"</span>, , <span class="keyword">new</span> Field(<span class="string">"f2"</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>setBoltæ—¶è®¾ç½®çš„componentId/operatorIdéƒ½æ˜¯è‡ªå·±Bolt, åˆ†ç»„æ—¶çš„componentIdåˆ™æ˜¯è¾“å…¥çš„componentId/operatorId.  </p>
</blockquote>
<p>é€šè¿‡è§£æCQLçš„åˆ†ç»„ä»¥åŠç®—å­/ç»„ä»¶ä¹‹é—´çš„è¿æ¥, ç°åœ¨å°±ä¸éœ€è¦åœ¨Topologyå†™æ­»äº†. å› æ­¤éœ€è¦æ¡†æ¶èƒ½å¤ŸåŠ¨æ€åœ°æ„å»ºTopology.  </p>
<blockquote>
<p>ä¸ºä»€ä¹ˆIRichOperatorçš„getInputStream()å’ŒgetOutputStream()è¡¨ç¤ºçš„æ˜¯è¾“å…¥æµå’Œè¾“å‡ºæµçš„åç§°, è€Œä¸æ˜¯è¾“å…¥æµå¯¹è±¡å’Œè¾“å‡ºæµå¯¹è±¡(æ¯”å¦‚ç®—å­æœ¬èº«).<br>è¿™æ˜¯å› ä¸ºOperatorç®—å­ä¼šç”¨äºTopologyçš„Spout/Bolt, åˆ›å»ºå®ŒSpout/Boltä¹‹å, ç”¨äºæ„å»ºTopologyå…¶ä»–å¿…è¦çš„ä¿¡æ¯é™¤äº†åˆ†ç»„å¤–,<br>è¿˜æœ‰Stormçš„component-idå¯¹åº”ç®—å­çš„id å’Œ Stormçš„stream-idå¯¹åº”ç®—å­çš„è¾“å…¥/è¾“å‡ºæµåç§°  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setOperatorGrouping</span><span class="params">(IRichOperator operator)</span> </span>&#123;</span><br><span class="line">    BoltDeclarer bolt = createBoltDeclarer(operator);</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªBoltå¯èƒ½æœ‰å¤šä¸ªè¾“å…¥å³å¤šä¸ªInputStream, åŒæ—¶è¾“å‡ºä¹Ÿå¯èƒ½æœ‰å¤šä¸ª: è®¾ç½®ä¸åŒçš„Groupingç­–ç•¥</span></span><br><span class="line">    <span class="comment">//æ³¨æ„: Boltè®¾ç½®åˆ†ç»„æ—¶çš„componentIdæ˜¯å…¶è¾“å…¥æºçš„ComponentId,è€Œä¸æ˜¯è‡ªå·±çš„componentId, è‡ªå·±æ˜¯åœ¨builder.setBoltæ—¶è®¾ç½®çš„</span></span><br><span class="line">    <span class="keyword">for</span> (String strname : operator.getInputStream()) &#123;              <span class="comment">//strnameæ˜¯å½“å‰ç®—å­çš„è¾“å…¥æµåç§°</span></span><br><span class="line">        GroupInfo groupInfo = operator.getGroupInfo().get(strname); <span class="comment">//ç®—å­çš„åˆ†ç»„ä¿¡æ¯</span></span><br><span class="line">        setBoltGrouping(bolt, strname, groupInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setBoltGrouping</span><span class="params">(BoltDeclarer bolt, String strname, GroupInfo groupInfo)</span> </span>&#123;        </span><br><span class="line">    DistributeType distribute = groupInfo.getDitributeType();</span><br><span class="line">    <span class="keyword">switch</span> (distribute) &#123;</span><br><span class="line">        <span class="keyword">case</span> FIELDS:</span><br><span class="line">            Fields fields = <span class="keyword">new</span> Fields(groupInfo.getFields());</span><br><span class="line">            <span class="comment">//æ ¹æ®è¾“å…¥æµçš„åç§°, è·å–è¿™ä¸ªè¾“å…¥æµæ˜¯ä¸ªä»€ä¹ˆç®—å­, ä¸ºçš„æ˜¯è·å¾—è¿™ä¸ªè¾“å…¥ç®—å­çš„operatorId,ä½œä¸ºåˆ†ç»„ç­–ç•¥çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">            IRichOperator operator = getOperatorByOutputStreamName(strname);</span><br><span class="line">            <span class="comment">//å­—æ®µåˆ†ç»„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤º: componentId, streamId, fields. è¿™é‡Œçš„componentIdè¡¨ç¤ºä»å“ªä¸ªæ•°æ®æºæ¥å…¥æ•°æ®,è€Œä¸æ˜¯å½“å‰ç®—å­çš„operatorId</span></span><br><span class="line">            bolt.fieldsGrouping(operator.getOperatorId(), strname, fields);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//... å…¶ä»–åˆ†ç»„ç±»å‹ ...   </span></span><br><span class="line">        <span class="keyword">default</span>:               </span><br><span class="line">            setDefaultBoltGrouping(bolt, strname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDefaultBoltGrouping</span><span class="params">(BoltDeclarer bolt, String strname)</span> </span>&#123;</span><br><span class="line">    IRichOperator operator = getOperatorByOutputStreamName(strname);</span><br><span class="line">    <span class="comment">//shuffleåˆ†ç»„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤º: è¾“å…¥æµçš„operatorId/componentId, streamId</span></span><br><span class="line">    bolt.shuffleGrouping(operator.getOperatorId(), strname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Operatorç®—å­çš„idä¼šä½œä¸ºStormä¸­Spout/Boltçš„component-id, è€ŒOperatorçš„è¾“å…¥æµ/è¾“å‡ºæµåç§°æ˜¯ä½œä¸ºSpout/Boltçš„stream-id.<br>component-idåªæ˜¯ç”¨äºåŒºåˆ«ä¸åŒçš„ç»„ä»¶,æˆ–è€…ç”¨äºä»å“ªä¸ªè¾“å…¥ç»„ä»¶è·å–æ•°æ®. è€Œstream-idåˆ™å¯ä»¥ä½œä¸ºåˆ†æµ/å¤šæµ/åˆå¹¶æµç­‰.  </p>
</blockquote>
<h3 id="Bolt_Creation">Bolt Creation</h3><p>createBoltsè®¾ç½®Operatorçš„åˆ†ç»„ç­–ç•¥, é¦–å…ˆåˆ›å»ºIRichBolt,å¹¶è¿”å›Boltçš„å£°æ˜BoltDeclarer,ä»¥ä¾¿åç»­æ“ä½œå¯ä»¥åœ¨BoltDeclarerç»§ç»­è¿›è¡Œ(æ¯”å¦‚ä¸Šé¢çš„åˆ†ç»„ç­–ç•¥).  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> BoltDeclarer <span class="title">createBoltDeclarer</span><span class="params">(IRichOperator operator)</span></span>&#123;</span><br><span class="line">    IRichBolt bolt;</span><br><span class="line">    <span class="keyword">if</span> ((operator <span class="keyword">instanceof</span> FunctionOperator) || (operator <span class="keyword">instanceof</span> FunctionStreamOperator)) &#123;</span><br><span class="line">        bolt = createStormBolt(operator);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        bolt = createOutputStormBolt(operator);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> builder.setBolt(operator.getOperatorId(), bolt, operator.getParallelNumber());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> IRichBolt <span class="title">createOutputStormBolt</span><span class="params">(IRichOperator f)</span></span>&#123;</span><br><span class="line">    StormOutputBolt outputbolt = <span class="keyword">new</span> StormOutputBolt();</span><br><span class="line">    outputbolt.setOperator(f);</span><br><span class="line">    <span class="keyword">return</span> outputbolt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> IRichBolt <span class="title">createStormBolt</span><span class="params">(IRichOperator f)</span></span>&#123;</span><br><span class="line">    StormBolt stormbolt = <span class="keyword">new</span> StormBolt();</span><br><span class="line">    stormbolt.setOperator(f);</span><br><span class="line">    <span class="keyword">return</span> stormbolt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StormSpout,StormBolt,StormOutputBoltéƒ½æ˜¯å¯¹Stormçš„ç»„ä»¶çš„å°è£…. é™¤äº†ç»§æ‰¿å„è‡ªçš„IRichSpoutå’ŒIRichBoltå¤–,è¿˜è¦å®ç°StreamAdapteræ¥å£çš„setOperatoræ–¹æ³•.<br>æµå¤„ç†ç®—å­é€‚é…æ¥å£: ä¾é è¿™ä¸ªæ¥å£ï¼Œå°†æµå¤„ç†çš„ç®—å­æ³¨å…¥åˆ°å…·ä½“çš„Stormçš„Spout/Boltä¸­. <code>åˆ›å»ºBoltä¸ºå•¥ä¸ç”¨æ„é€ å‡½æ•°ä¸€å¥è¯çš„äº‹å„¿: new StormBolt(operator)</code>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StormSpout</span> <span class="keyword">implements</span> <span class="title">IRichSpout</span>, <span class="title">StreamAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> IRichOperator input;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperator</span><span class="params">(IRichOperator operator)</span></span>&#123;</span><br><span class="line">        input = operator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StormOutputBolt</span> <span class="keyword">implements</span> <span class="title">IRichBolt</span>, <span class="title">StreamAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> OutputCollector outputCollector;</span><br><span class="line">    <span class="keyword">private</span> OutputOperator output;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperator</span><span class="params">(IRichOperator operator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.output = (OutputOperator)operator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StormBoltçš„executeæ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input)</span> </span>&#123;</span><br><span class="line">    String sourceStreamName = input.getSourceStreamId();        <span class="comment">//è·å–Tupleçš„è¾“å…¥æµstream-id</span></span><br><span class="line">    List&lt;String&gt; inStreams = functionStream.getInputStream();   <span class="comment">//è¾“å…¥æµåç§°åˆ—è¡¨,å› ä¸ºä¸€ä¸ªBoltå¯ä»¥æœ‰å¤šä¸ªè¾“å…¥æµ</span></span><br><span class="line">    <span class="keyword">for</span> (String streamName : inStreams) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!sourceStreamName.equals(streamName)) <span class="keyword">continue</span>;     <span class="comment">//åªæœ‰Tupleçš„è¾“å…¥æµstream-idå’ŒIRichOperatorçš„è¾“å…¥æµåç§°ç›¸åŒæ—¶,æ‰å¤„ç†è¿™ä¸ªTuple</span></span><br><span class="line">        TupleEvent event = TupleTransform.tupeToEvent(input, functionStream.getInputSchema().get(streamName));</span><br><span class="line">        functionStream.execute(streamName, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | start to submit application example | com.huawei.streaming.cql.executor.PhysicalPlanExecutor (PhysicalPlanExecutor.java:<span class="number">201</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | reset submit jar to /<span class="keyword">private</span>/var/folders/xc/x0b8crk9667ddh1zhfs29_zr0000gn/T/example<span class="number">.5f</span>8ed0baaeb243a49308fd75144cf715.jar | com.huawei.streaming.storm.StormApplication (StormApplication.java:<span class="number">314</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Using defaults.yaml from resources | backtype.storm.utils.Utils (Utils.java:<span class="number">253</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | The baseSleepTimeMs [<span class="number">2000</span>] the maxSleepTimeMs [<span class="number">60000</span>] the maxRetries [<span class="number">5</span>] | backtype.storm.utils.StormBoundedExponentialBackoffRetry (StormBoundedExponentialBackoffRetry.java:<span class="number">47</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Using defaults.yaml from resources | backtype.storm.utils.Utils (Utils.java:<span class="number">253</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | GenFunctionOpsOrder enter. | com.huawei.streaming.application.OperatorMng (OperatorMng.java:<span class="number">205</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Using defaults.yaml from resources | backtype.storm.utils.Utils (Utils.java:<span class="number">253</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Generated ZooKeeper secret payload <span class="keyword">for</span> MD5-digest: -<span class="number">5668598407594625313</span>:-<span class="number">5703359794945963404</span> | backtype.storm.StormSubmitter (StormSubmitter.java:<span class="number">82</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">39</span> | INFO  | [main] | Uploading topology jar /<span class="keyword">private</span>/var/folders/xc/x0b8crk9667ddh1zhfs29_zr0000gn/T/example<span class="number">.5f</span>8ed0baaeb243a49308fd75144cf715.jar to assigned location: storm-local/nimbus/inbox/stormjar-a5b95134-e3f2-<span class="number">431</span>d-b675-<span class="number">924</span>d8c468cf3.jar | backtype.storm.StormSubmitter (StormSubmitter.java:<span class="number">371</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">40</span> | INFO  | [main] | Successfully uploaded topology jar to assigned location: storm-local/nimbus/inbox/stormjar-a5b95134-e3f2-<span class="number">431</span>d-b675-<span class="number">924</span>d8c468cf3.jar | backtype.storm.StormSubmitter (StormSubmitter.java:<span class="number">396</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">40</span> | INFO  | [main] | Finished submitting topology: example | backtype.storm.StormSubmitter (StormSubmitter.java:<span class="number">248</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">40</span> | INFO  | [main] | <span class="keyword">delete</span> user packed jar after submit | com.huawei.streaming.cql.executor.PhysicalPlanExecutor (PhysicalPlanExecutor.java:<span class="number">156</span>)</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">25</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">40</span> | INFO  | [main] | unRegister jars from <span class="keyword">class</span> loader. | com.huawei.streaming.cql.DriverContext (DriverContext.java:<span class="number">427</span>)</span><br></pre></td></tr></table></figure>
			  
		</div>

		<!-- pagination -->
	  

		
  


	</div>
	<div class="col-md-4">
		
			
				<div id="sidebar">
	 			
	 					
<div class="widget">
  <h4>æœ€æ–°æ–‡ç« </h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2015/11/30/2015-11-29-StreamCQL-application/"  > <i class="mdi-editor-insert-drive-file"></i>StreamCQLæºç é˜…è¯»(4) åº”ç”¨ç¨‹åºæ‰§è¡Œ</a>
      </li>
    
      <li>
        <a href="/2015/11/30/2015-11-27-StreamCQL-operator/"  > <i class="mdi-editor-insert-drive-file"></i>StreamCQLæºç é˜…è¯»(3) æ‹†åˆ†ç»„åˆç®—å­</a>
      </li>
    
      <li>
        <a href="/2015/11/30/2015-11-26-StreamCQL-schema/"  > <i class="mdi-editor-insert-drive-file"></i>StreamCQLæºç é˜…è¯»(2) è¯­æ³•å’Œè¯­ä¹‰è§£æ</a>
      </li>
    
      <li>
        <a href="/2015/11/30/2015-11-24-StreamCQL-task/"  > <i class="mdi-editor-insert-drive-file"></i>StreamCQLæºç é˜…è¯»(1) æäº¤ä»»åŠ¡</a>
      </li>
    
      <li>
        <a href="/2015/11/30/2015-11-10-Cassandra-Client/"  > <i class="mdi-editor-insert-drive-file"></i>Cassandra ClientæŸ¥è¯¢ä¼˜åŒ–</a>
      </li>
    
  </ul>
</div>


	 				
	 					
<div class="widget">
	<h4>é“¾æ¥</h4>
	<ul class="blogroll list-unstyled">
	
		<li> <a href="http://www.github.com/zqhxuyuan" title="åŒæ€§äº¤å‹ç¤¾åŒº" target="_blank"> <i class="mdi-action-launch"></i> GitHub</a></li>
	
		<li> <a href="http://www.weibo.com/xuyuantree" title="" target="_blank"> <i class="mdi-action-launch"></i> Weibo</a></li>
	
	</ul>
</div>


	 				
	 			</div>
			
		
	</div>

</div>


			<footer>
				

<p>
  ç”± <a href="https://hexo.io">hexo</a> å¼ºåŠ›é©±åŠ¨ | æ­è½½ <a href="https://github.com/wayou/hexo-theme-material">material</a> ä¸»é¢˜
</p>
<p>
  &copy; 2015 <a href="http://github.com/zqhxuyuan"> zqhxuyuan </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

			</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
