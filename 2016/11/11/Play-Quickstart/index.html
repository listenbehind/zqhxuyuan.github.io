<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>PlayFramework快速入门 | zqhxuyuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player
&amp;lt;!-- MarkdownTOC --&amp;gt;

Run! Run!! Run!!!
Hello World!
路由和Controller
页面和渲染
模板编译




Products Example
implicit


Spark集成
play-spar">
<meta property="og:type" content="article">
<meta property="og:title" content="PlayFramework快速入门">
<meta property="og:url" content="http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/index.html">
<meta property="og:site_name" content="zqhxuyuan">
<meta property="og:description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player
&amp;lt;!-- MarkdownTOC --&amp;gt;

Run! Run!! Run!!!
Hello World!
路由和Controller
页面和渲染
模板编译




Products Example
implicit


Spark集成
play-spar">
<meta property="og:image" content="http://img.blog.csdn.net/20161111154235071">
<meta property="og:image" content="http://img.blog.csdn.net/20161111154733495">
<meta property="og:image" content="http://img.blog.csdn.net/20161111170901722">
<meta property="og:image" content="http://img.blog.csdn.net/20161111170829019">
<meta property="og:image" content="http://img.blog.csdn.net/20161118100439795">
<meta property="og:image" content="http://img.blog.csdn.net/20161118100453598">
<meta property="og:image" content="http://img.blog.csdn.net/20161125100527204">
<meta property="og:image" content="http://img.blog.csdn.net/20161125100553908">
<meta property="og:image" content="http://img.blog.csdn.net/20161129174641219">
<meta property="og:image" content="http://img.blog.csdn.net/20170512105246182">
<meta property="og:image" content="http://img.blog.csdn.net/20170512103522643">
<meta property="og:image" content="http://img.blog.csdn.net/20170512103539643">
<meta property="og:image" content="http://img.blog.csdn.net/20170512104754468">
<meta property="og:image" content="http://img.blog.csdn.net/20170512105802005">
<meta property="og:updated_time" content="2017-09-01T03:09:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PlayFramework快速入门">
<meta name="twitter:description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player
&amp;lt;!-- MarkdownTOC --&amp;gt;

Run! Run!! Run!!!
Hello World!
路由和Controller
页面和渲染
模板编译




Products Example
implicit


Spark集成
play-spar">
  
    <link rel="alternative" href="/atom.xml" title="zqhxuyuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">任何忧伤,都抵不过世界的美丽</a></h1>
		</hgroup>

		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">归档</a></li>
				        
							<li><a href="/tags/">标签</a></li>
				        
							<li><a href="/about/">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/akka/" style="font-size: 10px;">akka</a> <a href="/tags/apex/" style="font-size: 10px;">apex</a> <a href="/tags/bigdata/" style="font-size: 10px;">bigdata</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/cassandra/" style="font-size: 18.75px;">cassandra</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/drill/" style="font-size: 16.25px;">drill</a> <a href="/tags/druid/" style="font-size: 13.75px;">druid</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/etl/" style="font-size: 10px;">etl</a> <a href="/tags/geode/" style="font-size: 10px;">geode</a> <a href="/tags/graph/" style="font-size: 13.75px;">graph</a> <a href="/tags/hadoop/" style="font-size: 11.25px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 15px;">hbase</a> <a href="/tags/ignite/" style="font-size: 10px;">ignite</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/kafka/" style="font-size: 20px;">kafka</a> <a href="/tags/midd/" style="font-size: 11.25px;">midd</a> <a href="/tags/ops/" style="font-size: 13.75px;">ops</a> <a href="/tags/redis/" style="font-size: 11.25px;">redis</a> <a href="/tags/rocketmq/" style="font-size: 10px;">rocketmq</a> <a href="/tags/scala/" style="font-size: 13.75px;">scala</a> <a href="/tags/spark/" style="font-size: 17.5px;">spark</a> <a href="/tags/storm/" style="font-size: 17.5px;">storm</a> <a href="/tags/timeseries/" style="font-size: 12.5px;">timeseries</a> <a href="/tags/work/" style="font-size: 13.75px;">work</a> <a href="/tags/流处理/" style="font-size: 11.25px;">流处理</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">BIG(DATA)</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">归档</a></li>
		        
					<li><a href="/tags/">标签</a></li>
		        
					<li><a href="/about/">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Play-Quickstart" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/11/Play-Quickstart/" class="article-date">
  	<time datetime="2016-11-10T16:00:00.000Z" itemprop="datePublished">2016-11-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PlayFramework快速入门
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/scala/">scala</a>
	</div>


        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li></ul>
	</div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <p>Scala PlayFramework（2.4）入门<br>示例程序：<a href="https://github.com/zqhxuyuan/first-player">https://github.com/zqhxuyuan/first-player</a></p>
<!-- MarkdownTOC -->
<ul>
<li>Run! Run!! Run!!!</li>
<li>Hello World!<ul>
<li>路由和Controller</li>
<li>页面和渲染<ul>
<li>模板编译</li>
</ul>
</li>
</ul>
</li>
<li>Products Example<ul>
<li>implicit</li>
</ul>
</li>
<li>Spark集成<ul>
<li>play-spark-module</li>
<li>Spark Launcher<ul>
<li>mesos</li>
<li>问题</li>
</ul>
</li>
<li>Spark Cassandra</li>
<li>预览</li>
<li>Actor</li>
<li>Quartz<ul>
<li>Job依赖注入</li>
<li>Quartz作业的自动重启</li>
</ul>
</li>
<li>Kafka</li>
</ul>
</li>
<li>附录<ul>
<li>sbt私服</li>
<li>Play MultiProject</li>
<li>Run &amp; Debug With IDEA<ul>
<li><ol>
<li>Play App（❌）</li>
</ol>
</li>
<li><ol>
<li>Sbt Task（✅）</li>
</ol>
</li>
<li><ol>
<li>jvm-debug（✅）</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC -->
<a id="more"></a>
<h1 id="Run!_Run!!_Run!!!">Run! Run!! Run!!!</h1><p><strong>安装activator</strong>  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install typesafe-activator</span><br><span class="line">activator new first-player</span><br><span class="line"><span class="built_in">cd</span> first-player</span><br><span class="line">activator run</span><br></pre></td></tr></table></figure>
<p><strong>导入IntelliJ IDEA</strong>  </p>
<ol>
<li>install IDEA professional</li>
<li>install PlayFramework support</li>
<li>import SBT project</li>
<li>right click controllers.Products, Run Play2 App in idea</li>
</ol>
<h1 id="Hello_World!">Hello World!</h1><p><code>activator new first-player</code>生成的目录结构如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜  first-player tree -L <span class="number">2</span></span><br><span class="line">.</span><br><span class="line">├── activator                   使用activator new才有该文件</span><br><span class="line">├── activator-launch-<span class="number">1.3</span>.<span class="number">4</span><span class="class">.jar</span></span><br><span class="line">├── app </span><br><span class="line">│   ├── controllers             控制器</span><br><span class="line">│   ├── models                  模型</span><br><span class="line">│   └── views                   视图（Web页面）</span><br><span class="line">├── build<span class="class">.sbt</span></span><br><span class="line">├── conf</span><br><span class="line">│   ├── application<span class="class">.conf</span>        配置文件</span><br><span class="line">│   └── routes                  路由配置</span><br><span class="line">├── project</span><br><span class="line">│   ├── build<span class="class">.properties</span></span><br><span class="line">│   ├── plugins<span class="class">.sbt</span>             插件配置</span><br><span class="line">├── public                      样式和脚本</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── javascripts</span><br><span class="line">│   └── stylesheets</span><br></pre></td></tr></table></figure>
<h2 id="路由和Controller">路由和Controller</h2><p>路由配置：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># http://localhost:9000</span></span><br><span class="line"><span class="keyword">GET</span>     /                           controllers.HomeController.index</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># http://localhost:9000/hello?n=Play!</span></span><br><span class="line"><span class="keyword">GET</span>     /hello                      controllers.HomeController.hello(n: <span class="built_in">String</span>)</span><br></pre></td></tr></table></figure>
<p>对应的HomeController方法：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject._</span><br><span class="line"><span class="keyword">import</span> models.<span class="type">Product</span></span><br><span class="line"><span class="keyword">import</span> play.api._</span><br><span class="line"><span class="keyword">import</span> play.api.mvc._</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="title">@Inject</span>(</span>) <span class="keyword">extends</span> <span class="type">Controller</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span> =</span> <span class="type">Action</span> &#123;</span><br><span class="line">    <span class="type">Ok</span>(views.html.index(<span class="string">"Your new application is ready."</span>))  <span class="comment">//①</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hello</span>(</span>name: <span class="type">String</span>) = <span class="type">Action</span> &#123;</span><br><span class="line">    <span class="comment">//Ok("Hello " + name)</span></span><br><span class="line">    <span class="type">Ok</span>(views.html.hello(name))  <span class="comment">//②</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>①：index方法的Response响应会返回一个Html页面，指向<code>app/views/index.scala.html</code>页面<br>②：hello方法的响应返回<code>app/views/hello.scala.html</code>页面，只不过这个页面会渲染一个参数</p>
<blockquote>
<p>注：如果Controller的Action方法是Ok(“字符串”)则返回的是一个字符串。<br>2.2版本中Controller可以用object，在2.4需要用class，以及@Inject和@Singleton</p>
</blockquote>
<p>本节知识点：</p>
<ol>
<li>路由配置到控制器的映射</li>
<li>Action的Response返回值如何指向页面</li>
<li>Action的参数如何传递给页面</li>
</ol>
<h2 id="页面和渲染">页面和渲染</h2><p>views是Play的html页面，也可以在该页面下新建子目录。在IntelliJ中，在views下创建子目录，<br>也是创建一个Package，，因为views和controllers的等级相同。  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  app tree views</span><br><span class="line">views</span><br><span class="line">├── hello<span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">├── index<span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">├── main<span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">├── products</span><br><span class="line">│   ├── <span class="tag">details</span><span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">│   ├── edit<span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">│   ├── list<span class="class">.scala</span><span class="class">.html</span></span><br><span class="line">│   └── main<span class="class">.scala</span><span class="class">.html</span></span><br></pre></td></tr></table></figure>
<p>app/views/index.scala.html：index方法中的”Your new application is ready.”<br>会传递到index.scala.html作为第一行的message参数。  </p>
<p>@main调用的是同一个路径的main.scala.html模板页面，也可以用@views.html.main绝对路径。<br>Play的scala.html页面实际上是模板，可以用Scala代码的方式来调用。<br>所以@main方法的第一参数是字符串（标题），第二个参数是Html对象用来表示page body。<br>@play20.welcome是Play内置的一个方法（绝对路径是@views.html.play20）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@(message: String)</span><br><span class="line"></span><br><span class="line">@main("Welcome to Play") &#123;</span><br><span class="line">    @play20.welcome(message, style = "Scala")</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的@main方法会调用同路径的main.scala.html模板页面（Layout嵌套）。<br>app/views/main.scala.html：第一行有两个参数，而且是参数列表的方式，而不是两个参数放在一起。  </p>
<p>index页面的”Welcome to Play”作为title参数，第二个参数则作为content参数，正好对应了Html类型。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@(title: String)(content: Html)</span><br><span class="line"></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">title</span>&gt;</span>@title<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"screen"</span> <span class="attribute">href</span>=<span class="value">"@routes.Assets.versioned("</span><span class="value">stylesheets</span>/<span class="attribute">main.css</span>")"&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"shortcut icon"</span> <span class="attribute">type</span>=<span class="value">"image/png"</span> <span class="attribute">href</span>=<span class="value">"@routes.Assets.versioned("</span><span class="value">images</span>/<span class="attribute">favicon.png</span>")"&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">        @content</span><br><span class="line">    <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>两个参数放在一起的话，类似：@(title: String, content: Html)。对应的调用方式也要更改为：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@main</span>(<span class="string">"Welcome to Play"</span>, &#123;</span><br><span class="line">    <span class="variable">@play20</span>.<span class="function">welcome</span>(message, style = <span class="string">"Scala"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>本节知识点：</p>
<ol>
<li>views子目录的创建，以及在控制器中如何访问到指定子目录下的页面</li>
<li>页面的参数定义和使用（@标记后面的都是Scala代码），参数列表</li>
<li>嵌套模板的使用，对应的Scala方法</li>
<li>缺省的模板调用路径是和当前页面相同路径，绝对路径是<code>@views.html.</code></li>
</ol>
<h3 id="模板编译">模板编译</h3><p>views下的每个页面都会被编译成Scala的模板类，下面右图views.html实际上就和控制器的调用是类似的。  </p>
<blockquote>
<p>如果是其他格式，比如json、xml，则用views.json或者views.xml，可见不总是views.html。</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20161111154235071" alt="play vies"></p>
<p>HomeController的idnex方法</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> =</span> <span class="type">Action</span> &#123;</span><br><span class="line">  <span class="type">Ok</span>(views.html.index(<span class="string">"Your new application is ready."</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后的文件路径：target/scala-2.11/twirl/main/views.html/index.template.scala<br>index是一个object，对应index类的apply方法，接收一个参数，参数名称为message。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">index_Scope0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">index</span>  &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span>(</span>message: <span class="type">String</span>):play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = &#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span>(</span>message:<span class="type">String</span>): play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = apply(message)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span>:</span>((<span class="type">String</span>) =&gt; play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span>) = (message) =&gt; apply(message)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ref</span>:</span> <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">index</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">index_Scope0</span>.<span class="title">index</span></span></span><br></pre></td></tr></table></figure>
<p>index.scala.html调用@main方法对应的views/main.scala.html</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">(message:</span> String)</span><br><span class="line">@<span class="function">main</span>(<span class="string">"Welcome to Play"</span>) </span>&#123;</span><br><span class="line">    <span class="at_rule">@<span class="keyword">play20.welcome(message,</span> style = <span class="string">"Scala"</span>)</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>main方法对应的编译文件：target/scala-2.11/twirl/main/views.html/main.template.scala<br>main类的apply方法有两个参数，分别是(title: String)(content: Html)</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">main_Scope0</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">main</span> &#123;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">apply</span>(</span>title: <span class="type">String</span>)(content: <span class="type">Html</span>):play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = &#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">render</span>(</span>title:<span class="type">String</span>,content:<span class="type">Html</span>): play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = apply(title)(content)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>:</span>((<span class="type">String</span>) =&gt; (<span class="type">Html</span>) =&gt; play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span>) = (title) =&gt; (content) =&gt; apply(title)(content)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ref</span>:</span> <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">main</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">main_Scope0</span>.<span class="title">main</span></span></span><br></pre></td></tr></table></figure>
<h1 id="Products_Example">Products Example</h1><p>路由配置：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST    /products                      controllers<span class="class">.Products</span><span class="class">.save</span></span><br><span class="line">GET     /products/new                  controllers<span class="class">.Products</span><span class="class">.newProduct</span></span><br><span class="line">GET     /products                      controllers<span class="class">.Products</span><span class="class">.products</span></span><br><span class="line">GET     /products/:ean                 controllers<span class="class">.Products</span><span class="class">.show</span>(ean: Long)</span><br></pre></td></tr></table></figure>
<p>Products控制器，为了支持国际化，添加I18nSupport接口。注意每个Action都添加了<code>implicit request =&gt;</code></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Products</span> <span class="title">@Inject</span>(</span>) (<span class="keyword">val</span> messagesApi: <span class="type">MessagesApi</span>) <span class="keyword">extends</span> <span class="type">Controller</span> <span class="keyword">with</span> <span class="type">I18nSupport</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">products</span> =</span> <span class="type">Action</span> &#123; <span class="keyword">implicit</span> request =&gt;</span><br><span class="line">    <span class="keyword">val</span> products = <span class="type">Product</span>.findAll</span><br><span class="line">    <span class="type">Ok</span>(views.html.products.list(products))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span>(</span>ean: <span class="type">Long</span>) = <span class="type">Action</span> &#123; <span class="keyword">implicit</span> request =&gt;</span><br><span class="line">    <span class="type">Product</span>.findByEan(ean).map &#123; product =&gt;</span><br><span class="line">      <span class="type">Ok</span>(views.html.products.details(product))</span><br><span class="line">    &#125;.getOrElse(<span class="type">NotFound</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>views/products/list.scala.html</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@(productList: List[Product])(implicit lang: Messages)</span><br><span class="line"></span><br><span class="line">@products.main(Messages("application.name")) &#123;</span><br><span class="line">    &lt;dl class="products"&gt;</span><br><span class="line">    @for(product &lt;- productList) &#123;</span><br><span class="line">        &lt;dt&gt;&lt;a href="@controllers.routes.Products.show(product.ean)"&gt;@product.ean&lt;/a&gt;&lt;/dt&gt;</span><br><span class="line">        &lt;dt&gt;@product.name&lt;/dt&gt;</span><br><span class="line">        &lt;dd&gt;@product.description&lt;/dd&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/dl&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意第一行的参数<code>productList</code>不能命名为：<code>products</code>，否则第二行的<code>@products.main</code>会报错，<br>它会认为<code>products</code>来自于第一行的参数，但这个参数并没有<code>main</code>方法（List没有main方法）。而实际上<code>@products.main</code><br>代表的是要调用<code>@views.html.products.main</code>对应的<code>views/products/main.scala.html</code>页面。<br>注意：<code>productList</code>参数名称不需要和<code>Products</code>控制器的<code>products</code>方法的<code>products</code>变量相同，只要类型相同即可，所以可以是任意的名称。</p>
</blockquote>
<p>这里还有一个隐式的Messages，用来做国际化的支持。</p>
<p>反向路由：在product的en上超链接：”@controllers.routes.Products.show(product.ean)”，也可以省略掉controllers：”@routes.Products.show(product.ean)”。<br>在从路由配置到控制器时，Play会帮我们创建一个控制器到路由的反向路由配置。比如这里页面要访问”Products.show”方法。  </p>
<p><img src="http://img.blog.csdn.net/20161111154733495" alt="reverse route"></p>
<p>本节知识点：</p>
<ol>
<li>国际化的支持，以及implicit隐式参数的使用</li>
<li>参数名称不能和嵌套模板的子目录名称一样（比如参数productList，子目录是products，两者不能相同）</li>
<li>在页面中访问控制器方法，使用反向路由</li>
</ol>
<h2 id="implicit">implicit</h2><p>正常的Action调用</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//normal invoke, must pass Cart Object</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catalog10</span>(</span>) = <span class="type">Action</span> &#123; request =&gt;</span><br><span class="line">  <span class="keyword">val</span> products = <span class="type">ProductDAO</span>.list</span><br><span class="line">  <span class="type">Ok</span>(views.html.shop.catalog10(products, cart(request)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cart</span>(</span>request: <span class="type">RequestHeader</span>) = &#123;</span><br><span class="line">  <span class="type">Cart</span>.demoCart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@(products: Seq[Product3], cart: Cart)</span><br><span class="line"></span><br><span class="line">@shop.cart10("")(cart) &#123;</span><br><span class="line">    <span class="tag">&lt;<span class="title">h2</span>&gt;</span>Catalog<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line">    @views.html.shop.productList(products)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用implicit，不需要传递Cat对象，不过request需要使用implicit，同时还要提供一个能够生成Cart对象的方法或者trait接口</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//<span class="type">implicit</span> invoke, no need to <span class="keyword">pass</span> Cart</span><br><span class="line">def catalog11() = <span class="keyword">Action</span> &#123; <span class="type">implicit</span> request =&gt;</span><br><span class="line">  val products = ProductDAO.list</span><br><span class="line">  //too many arguments for method apply: (content: C)(<span class="type">implicit</span> writeable: play.api.http.Writeable[C])play.api.mvc.Result <span class="type">in</span> <span class="keyword">class</span> <span class="keyword">Status</span></span><br><span class="line">  //Ok(views.html.shop.catalog11(products), cart(request))</span><br><span class="line"></span><br><span class="line">  //如果没有定义<span class="type">implicit</span>的方法,是不会直接使用上面的cart方法的</span><br><span class="line">  //could not find <span class="type">implicit</span> <span class="keyword">value</span> for <span class="type">parameter</span> cart: models.Cart</span><br><span class="line">  Ok(views.html.shop.catalog11(products))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//方法名称任意,只要定义成<span class="type">implicit</span>即可</span><br><span class="line">//注意:如果去掉返回类型: models.Cart,也会报错说找不到models.Cart,所以要显示声明返回类型</span><br><span class="line"><span class="type">implicit</span> def cartImplicit(<span class="type">implicit</span> request: RequestHeader): models.Cart = &#123;</span><br><span class="line">  Cart.demoCart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的页面：可以看到参数中cart变成implicit，调用时，不需要传递cart了。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@(products: Seq[Product3])(<span class="type">implicit</span> cart: Cart)</span><br><span class="line"></span><br><span class="line">@shop.cart11(<span class="string">""</span>) &#123;</span><br><span class="line">    &lt;h2&gt;Catalog&lt;/h2&gt;</span><br><span class="line">    @views.html.shop.productList(products)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有implicit方法没有显示指定类型，也会报错：</p>
<p><img src="http://img.blog.csdn.net/20161111170901722" alt="implicit 1"></p>
<p>We’ve moved the Cart parameter to a second parameter list and made it implicit,<br>so we can apply this template and omit the second parameter list if an implicit Cart is available on the calling side. </p>
<p>Now we’ve declared the cart method as implicit. In addition, we’ve declared the RequestHeader parameter of<br>both our action and the cart method as implicit. If we now call the views.html.shop.catalog template and<br>omit the Cart parameter, the Scala compiler will look for an implicit Cart in scope. It’ll find the cart method,<br>which requires a RequestHeader parameter that’s also declared as implicit, but that’s also available.<br>We can make our newly created cart method reusable, by moving it into a trait. Then We can<br>now mix this trait into every controller where we need access to our implicit Cart.</p>
<p>我们定义了Action方法的RequestHeader（implicit request）以及cart方法（implicit def cartImplicit）都是implicit。<br>那么调用catalog模板（views.html.shop.catalog11(products)）时就可以省略Cart参数，Scala的编译器会在范围内寻找隐式的Cart对象。<br>它会找到cart方法（implicit def cartImplicit）。为了让隐式的Cart方法可重用，可以定义在一个接口中，这样其他控制器都可以使用这个方法</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">trait WithCart &#123;</span><br><span class="line">  <span class="type">implicit</span> def cart(<span class="type">implicit</span> request: RequestHeader) = &#123;</span><br><span class="line">    // Get cart from session</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161111170829019" alt="implicit cart"></p>
<p>虽然使用implicit有诸多好处，但是在需要添加其他implicit参数时，还要在页面中依次添加对应的(implicit)声明。解决办法是用一个对象来表示所有的隐式参数<br>然后在页面中使用这个隐式的对象即可，当需要添加隐式参数时，往对象中添加即可，页面中因为引用的是对象，所以自动继承了这个对象的所有隐式参数。</p>
<p>It’s often necessary to pass multiple values from your controller into your main template. Even with implicit parameters,<br>it would be a hassle to have to add another one each time, because you’d still have to add the implicit parameter to all<br>of the template definitions. One straightforward solution is to create a single class that contains all the objects you<br>need in your template, and pass an instance of that. If you want to add a value to it, you only need to adapt the template<br>where you use it, and the method that constructs it.  </p>
<p>It’s common to pass the RequestHeader or Request to templates, as we’ll see in section 6.7.2.<br>Play provides a WrappedRequest class, which wraps a Request and implements the interface itself as well,<br>so it’s usable as if it were a regular Request. But by extending WrappedRequest, you can add other fields:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case class UserDataRequest[<span class="link_label">A</span>](<span class="link_url">val user: User, val cart: Cart, request: Request[A]</span>) extends WrappedRequest(request)</span><br></pre></td></tr></table></figure>
<p>If you pass an instance of this UserDataRequest to your template, you have a refer- ence to the Request, User, and Cart.</p>
<h1 id="Spark集成">Spark集成</h1><p>Play和Spark使用的jackson依赖包有冲突，如果没有显示指定jackson，报错：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$<span class="variable">$anon</span><span class="variable">$1</span>: Execution exception[[RuntimeException: </span><br><span class="line">java.lang.VerifyError: class com.fasterxml.jackson.module.scala.ser.ScalaIteratorSerializer overrides final method withResolved.</span><br><span class="line">(Lcom/fasterxml/jackson/databind/BeanProperty;Lcom/fasterxml/jackson/databind/jsontype/TypeSerializer;</span><br><span class="line">  Lcom/fasterxml/jackson/databind/JsonSerializer;)Lcom/fasterxml/jackson/databind/ser/std/AsArraySerializerBase;]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:<span class="number">280</span>)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">206</span>)</span><br><span class="line">  at play.api.GlobalSettings<span class="variable">$class</span>.onError(GlobalSettings.scala:<span class="number">160</span>)</span><br><span class="line">  at Global$.onError(Global.scala:<span class="number">11</span>)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">98</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">99</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">344</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">343</span>)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<p><a href="https://groups.google.com/forum/#!topic/play-framework/LIf_Ughidcc" target="_blank" rel="external">https://groups.google.com/forum/#!topic/play-framework/LIf_Ughidcc</a><br><a href="https://github.com/FasterXML/jackson-module-scala/issues/214">https://github.com/FasterXML/jackson-module-scala/issues/214</a><br><a href="http://stackoverflow.com/questions/33815396/spark-com-fasterxml-jackson-module-error" target="_blank" rel="external">http://stackoverflow.com/questions/33815396/spark-com-fasterxml-jackson-module-error</a>  </p>
<p>没有指定jackson时，jackson-module-scala和jackson-databind的不一致：</p>
<p><img src="http://img.blog.csdn.net/20161118100439795" alt="play-spark-jackson1"></p>
<p>在build.sbt手动添加<code>jackson-module-scala</code>的依赖，版本和Play的一致。  </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">libraryDependencies</span> += <span class="string">"com.fasterxml.jackson.module"</span> % <span class="string">"jackson-module-scala_2.11"</span> % <span class="string">"2.7.6"</span></span><br></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161118100453598" alt="play-spark-jackson2"></p>
<p>如果Actor版本不对，执行Spark时可能报错：比如引入了libraryDependencies += “com.github.dnvriend” %% “akka-persistence-jdbc” % “2.6.8”<br>是的Actor版本从2.4.10升级到2.4.12</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$<span class="variable">$anon</span><span class="variable">$1</span>: Execution exception[[RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:<span class="number">293</span>)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">220</span>)</span><br><span class="line">  at play.api.GlobalSettings<span class="variable">$class</span>.onError(GlobalSettings.scala:<span class="number">160</span>)</span><br><span class="line">  at Global$.onError(Global.scala:<span class="number">11</span>)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">99</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">344</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">343</span>)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<h2 id="play-spark-module">play-spark-module</h2><p><a href="https://github.com/JoaoVasques/play-spark-module">https://github.com/JoaoVasques/play-spark-module</a>  </p>
<p>修改SparkController的timeout时间为30s，访问：<a href="http://localhost:9000/spark/count" target="_blank" rel="external">http://localhost:9000/spark/count</a>  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[warn] o<span class="class">.a</span><span class="class">.h</span><span class="class">.u</span><span class="class">.NativeCodeLoader</span> - Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line">[info] <span class="tag">p</span><span class="class">.m</span><span class="class">.i</span><span class="class">.j</span><span class="class">.p</span><span class="class">.s</span><span class="class">.w</span><span class="class">.SparkJobWorker</span> - Starting job <span class="number">1561847669</span> future</span><br><span class="line"><span class="number">3.216</span></span><br><span class="line">[info] <span class="tag">p</span><span class="class">.m</span><span class="class">.i</span><span class="class">.j</span><span class="class">.p</span><span class="class">.s</span><span class="class">.w</span><span class="class">.SparkJobWorker</span> - Job is done. Shutting down worker</span><br></pre></td></tr></table></figure>
<h2 id="Spark_Launcher">Spark Launcher</h2><p>Package org.apache.spark.launcher：Library for launching Spark applications.<br>This library allows applications to launch Spark programmatically. There’s only one entry point to the library - the SparkLauncher class.</p>
<p>The SparkLauncher.startApplication( org.apache.spark.launcher.SparkAppHandle.Listener…) can be used to start Spark and provide a handle to monitor and control the running application:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"><span class="keyword">import</span> org.apache.spark.launcher.SparkAppHandle;</span></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> org.apache.spark.launcher.SparkLauncher;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLauncher</span> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) throws Exception &#123;</span><br><span class="line">   SparkAppHandle handle = <span class="keyword">new</span> SparkLauncher()</span><br><span class="line">     .setAppResource(<span class="string">"/my/app.jar"</span>)</span><br><span class="line">     .setMainClass(<span class="string">"my.spark.app.Main"</span>)</span><br><span class="line">     .setMaster(<span class="string">"local"</span>)</span><br><span class="line">     .setConf(SparkLauncher.DRIVER_MEMORY, <span class="string">"2g"</span>)</span><br><span class="line">     .startApplication();</span><br><span class="line">   <span class="comment">// Use handle API to monitor / control application.</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s also possible to launch a raw child process, using the SparkLauncher.launch() method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.launcher.SparkLauncher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLauncher</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Process spark = <span class="keyword">new</span> SparkLauncher()</span><br><span class="line">     .setAppResource(<span class="string">"/my/app.jar"</span>)</span><br><span class="line">     .setMainClass(<span class="string">"my.spark.app.Main"</span>)</span><br><span class="line">     .setMaster(<span class="string">"local"</span>)</span><br><span class="line">     .setConf(SparkLauncher.DRIVER_MEMORY, <span class="string">"2g"</span>)</span><br><span class="line">     .launch();</span><br><span class="line">   spark.waitFor();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method requires the calling code to manually manage the child process, including its output streams (to avoid possible deadlocks). It’s recommended that SparkLauncher.startApplication( org.apache.spark.launcher.SparkAppHandle.Listener…) be used instead.</p>
<h3 id="mesos">mesos</h3><p>代码中指定本地文件（不推荐用法）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/zhengqh/Github/scala/simple-app</span><br><span class="line">mvn clean package</span><br><span class="line">~/Soft/spark-<span class="number">1.6</span><span class="number">.2</span>-bin-hadoop2<span class="number">.6</span>/bin/spark-submit --<span class="keyword">class</span> <span class="string">"SimpleApp"</span> --master local\[<span class="number">2</span>\] \</span><br><span class="line">target/scala-<span class="number">2.10</span>/simple-project_2<span class="number">.10</span>-<span class="number">1.0</span>.jar</span><br></pre></td></tr></table></figure>
<p>命令行指定file路径（也可以指定文件类型，比如本地或者hdfs，推荐用法）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-<span class="number">1.6</span><span class="number">.2</span>-bin-hadoop2<span class="number">.6</span>/bin/spark-submit --<span class="keyword">class</span> <span class="string">"SimpleApp"</span> --master local\[<span class="number">2</span>\] \</span><br><span class="line">--conf spark.app.logfile=<span class="string">"file:///Users/zhengqh/Github/scala/simple-app/README.md"</span> \</span><br><span class="line">target/scala-<span class="number">2.10</span>/simple-project_2<span class="number">.10</span>-<span class="number">1.0</span>.jar</span><br></pre></td></tr></table></figure>
<p>如果本地环境变量有HADOOP_CONF_DIR，需要注释掉，否则会使用hdfs，报错：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread "main" java.net.ConnectException: <span class="operator"><span class="keyword">Call</span> <span class="keyword">From</span> zqhmac/<span class="number">10.57</span><span class="number">.2</span><span class="number">.31</span> <span class="keyword">to</span> localhost:<span class="number">9000</span> </span><br><span class="line"><span class="keyword">failed</span> <span class="keyword">on</span> <span class="keyword">connection</span> <span class="keyword">exception</span>: <span class="keyword">java</span>.net.ConnectException: <span class="keyword">Connection</span> refused;</span> For more details see: </span><br><span class="line">http://wiki.apache.org/hadoop/ConnectionRefused</span><br></pre></td></tr></table></figure>
<p>命令行也可以指定其他运行方式，比如mesos，所以不推荐在代码中写死setMaster，除非开发时设置为setMaster(“local[*]”)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-<span class="number">1.6</span><span class="number">.2</span>-bin-hadoop2<span class="number">.6</span>/bin/spark-submit --<span class="keyword">class</span> <span class="string">"SimpleApp"</span> --master <span class="string">"mesos://192.168.6.52:5050"</span> \</span><br><span class="line">--conf spark.app.logfile=<span class="string">"file:///Users/zhengqh/Github/scala/simple-app/README.md"</span> \</span><br><span class="line">target/scala-<span class="number">2.10</span>/simple-project_2<span class="number">.10</span>-<span class="number">1.0</span>.jar</span><br></pre></td></tr></table></figure>
<p>在本地运行时报错：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to <span class="operator"><span class="keyword">load</span> <span class="keyword">native</span> Mesos <span class="keyword">library</span> <span class="keyword">from</span> /<span class="keyword">Users</span>/zhengqh/<span class="keyword">Library</span>/<span class="keyword">Java</span>/Extensions:/<span class="keyword">Library</span>/<span class="keyword">Java</span>/Extensions:</span><br><span class="line">/Network/<span class="keyword">Library</span>/<span class="keyword">Java</span>/Extensions:/<span class="keyword">System</span>/<span class="keyword">Library</span>/<span class="keyword">Java</span>/Extensions:/usr/lib/<span class="keyword">java</span>:.</span><br><span class="line"><span class="keyword">Exception</span> <span class="keyword">in</span> <span class="keyword">thread</span> <span class="string">"main"</span> <span class="keyword">java</span>.lang.UnsatisfiedLinkError: <span class="keyword">no</span> mesos <span class="keyword">in</span> <span class="keyword">java</span>.<span class="keyword">library</span>.<span class="keyword">path</span></span></span><br></pre></td></tr></table></figure>
<p>所以需要在本地安装有mesos环境，Mac安装mesos可以参考<a href="https://mesosphere.com/blog/2014/07/07/installing-mesos-on-your-mac-with-homebrew/" target="_blank" rel="external">https://mesosphere.com/blog/2014/07/07/installing-mesos-on-your-mac-with-homebrew/</a>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew <span class="operator"><span class="keyword">install</span> mesos</span><br><span class="line">/usr/<span class="keyword">local</span>/sbin/mesos-<span class="keyword">master</span> <span class="comment">--registry=in_memory --ip=127.0.0.1</span></span></span><br></pre></td></tr></table></figure>
<p>环境变量添加mesos:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For Linux</span></span><br><span class="line">$ <span class="built_in">export</span> MESOS_NATIVE_JAVA_LIBRARY=<span class="string">'/usr/local/lib/libmesos.so'</span></span><br><span class="line"><span class="comment"># For OSX</span></span><br><span class="line">$ <span class="built_in">export</span> MESOS_NATIVE_JAVA_LIBRARY=<span class="string">'/usr/local/lib/libmesos.dylib'</span></span><br></pre></td></tr></table></figure>
<p>本地安装好mesos,设置好mesos库，指定远程mesos：mesos://192.168.6.52:5050</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">Scheduler driver bound to loopback interface! Cannot communicate with remote master(s). You might want to set 'LIBPROCESS_IP' environment variable to use a routable IP address.</span><br><span class="line"><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">I1121 15:07:33.008949 778174464 sched.cpp:157] Version: 0.22.1</span><br><span class="line">I1121 15:07:33.016233 651489280 sched.cpp:254] New master detected at master<span class="comment">@192.168.6.52:5050</span></span><br></pre></td></tr></table></figure>
<p>但是，执行到上面后就不动了，可能是本地的mesos和远程mesos版本不对：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-<span class="number">1.6</span>.<span class="number">2</span>-bin-hadoop2.<span class="number">6</span>/bin/spark-submit --class <span class="string">"SimpleApp"</span> --master mesos:<span class="comment">//zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos \</span></span><br><span class="line">--conf spark<span class="class">.app</span><span class="class">.logfile</span>=<span class="string">"file:///Users/zhengqh/Github/scala/simple-app/README.md"</span> \</span><br><span class="line">target/scala-<span class="number">2.10</span>/simple-project_2.<span class="number">10</span>-<span class="number">1.0</span><span class="class">.jar</span></span><br><span class="line"></span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">34</span>:<span class="number">42.195302</span> <span class="number">655667200</span> group<span class="class">.cpp</span>:<span class="number">313</span>] Group process (<span class="function"><span class="title">group</span><span class="params">(<span class="number">1</span>)</span></span>@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">61225</span>) connected to ZooKeeper</span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">34</span>:<span class="number">42.195796</span> <span class="number">655667200</span> group<span class="class">.cpp</span>:<span class="number">790</span>] Syncing group operations: queue size (joins, cancels, datas) = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">34</span>:<span class="number">42.196069</span> <span class="number">655667200</span> group<span class="class">.cpp</span>:<span class="number">385</span>] Trying to create path <span class="string">'/mesos'</span> <span class="keyword">in</span> ZooKeeper</span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">34</span>:<span class="number">42.208238</span> <span class="number">662253568</span> detector<span class="class">.cpp</span>:<span class="number">138</span>] Detected <span class="tag">a</span> new leader: (id=<span class="string">'62'</span>)</span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">34</span>:<span class="number">42.208575</span> <span class="number">655667200</span> group<span class="class">.cpp</span>:<span class="number">659</span>] Trying to get <span class="string">'/mesos/json.info_0000000062'</span> <span class="keyword">in</span> ZooKeeper</span><br><span class="line">Failed to detect <span class="tag">a</span> master: Failed to parse data of unknown <span class="tag">label</span> <span class="string">'json.info</span></span><br></pre></td></tr></table></figure>
<p>如果指定本地mesos（要先在本地启动mesos-local）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-<span class="number">1.6</span><span class="number">.2</span>-bin-hadoop2<span class="number">.6</span>/bin/spark-submit --<span class="keyword">class</span> <span class="string">"SimpleApp"</span> --master <span class="string">"mesos://localhost:5050"</span> \</span><br><span class="line">--conf spark.app.logfile=<span class="string">"file:///Users/zhengqh/Github/scala/simple-app/README.md"</span> \</span><br><span class="line">target/scala-<span class="number">2.10</span>/simple-project_2<span class="number">.10</span>-<span class="number">1.0</span>.jar</span><br><span class="line"></span><br><span class="line">I1121 <span class="number">15</span>:<span class="number">11</span>:<span class="number">07.611460</span> <span class="number">515149824</span> sched.cpp:<span class="number">448</span>] Framework registered with <span class="number">20161121</span>-<span class="number">150645</span>-<span class="number">16777343</span>-<span class="number">5050</span>-<span class="number">14247</span>-<span class="number">0000</span> 出现Framework registered，实际上就说明连接本地mesos成功了</span><br><span class="line"><span class="number">16</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">07</span> INFO mesos.CoarseMesosSchedulerBackend: Registered as framework ID <span class="number">20161121</span>-<span class="number">150645</span>-<span class="number">16777343</span>-<span class="number">5050</span>-<span class="number">14247</span>-<span class="number">0000</span></span><br><span class="line"><span class="number">16</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">08</span> INFO mesos.CoarseMesosSchedulerBackend: SchedulerBackend is ready <span class="keyword">for</span> scheduling beginning after reached minRegisteredResourcesRatio: <span class="number">0.0</span></span><br><span class="line"><span class="number">16</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">08</span> INFO mesos.CoarseMesosSchedulerBackend: Mesos task <span class="number">0</span> is now TASK_RUNNING</span><br><span class="line"><span class="number">16</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">12</span> INFO spark.SparkContext: Starting job: count at SimpleApp.scala:<span class="number">13</span></span><br><span class="line">Lines with a: <span class="number">1</span>, Lines with b: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>或者将jar包上传到具有mesos环境的客户端节点，因为远程spark-mesos已经集成好了，所以可以不写–master</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/spark/bin/spark-submit --<span class="keyword">class</span> <span class="string">"SimpleApp"</span> --master <span class="string">"mesos://192.168.6.52:5050"</span> \</span><br><span class="line">--conf spark.app.logfile=<span class="string">"/user/qihuang.zheng/hello.txt"</span> \</span><br><span class="line">simple-project_2<span class="number">.10</span>-<span class="number">1.0</span>.jar</span><br></pre></td></tr></table></figure>
<h3 id="问题">问题</h3><p>远程运行任务，并指定proxy-user</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">sudo -u admin /usr/install/spark/bin/spark-submit \</span><br><span class="line">--master mesos:<span class="comment">//zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos \</span></span><br><span class="line">--class cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.demo</span><span class="class">.SimpleApp</span> \</span><br><span class="line">--proxy-user qihuang<span class="class">.zheng</span> \</span><br><span class="line">--conf spark<span class="class">.app</span><span class="class">.logfile</span>=<span class="string">"/user/qihuang.zheng/hello.txt"</span> \</span><br><span class="line">/usr/install/pontus/pontus-spark-<span class="number">1.0</span>.<span class="number">0</span>-SNAPSHOT-fat<span class="class">.jar</span></span><br><span class="line"></span><br><span class="line">sudo -u admin /usr/install/spark/bin/spark-submit \</span><br><span class="line">--master <span class="string">"mesos://zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos"</span> \</span><br><span class="line">--proxy-user qihuang<span class="class">.zheng</span> \</span><br><span class="line">--class cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.cassandra</span><span class="class">.PontusCassandra2HDFSJobHandler</span> \</span><br><span class="line">--conf spark<span class="class">.app</span><span class="class">.logfile</span>=<span class="string">"/usr/install/spark/README.md"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.destTable</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.tableId</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.destType</span>=<span class="string">"HDFS"</span> \</span><br><span class="line">--conf spark<span class="class">.cores</span><span class="class">.max</span>=<span class="string">"10"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.execution</span><span class="class">.id</span>=<span class="string">"3"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.destUsername</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.creator</span>=<span class="string">"qihuang.zheng"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.sourceUri</span>=<span class="string">"192.168.6.53/keyspace1"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.sourcePassword</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.mesos</span><span class="class">.role</span>=<span class="string">"test"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.sourceTable</span>=<span class="string">"standard1"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.sourceType</span>=<span class="string">"Cassandra"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.readMode</span>=<span class="string">"1"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.tableTs</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.destUri</span>=<span class="string">"/user/tongdun/pontus/standard1"</span> \</span><br><span class="line">--conf spark<span class="class">.executor</span><span class="class">.memory</span>=<span class="string">"4g"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.name</span>=<span class="string">"cassandra-hdfs"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.destPassword</span>=<span class="string">""</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.id</span>=<span class="string">"2"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.writeMode</span>=<span class="string">"1"</span> \</span><br><span class="line">--conf spark<span class="class">.pontus</span><span class="class">.sourceUsername</span>=<span class="string">""</span> \</span><br><span class="line">/usr/install/pontus/pontus-spark-<span class="number">1.0</span>.<span class="number">0</span>-SNAPSHOT-fat.jar</span><br></pre></td></tr></table></figure>
<p>mesos kill framework, but won’t kill spark driver</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">curl</span> -XPOST <span class="url">http://192.168.6.52:5050/master/teardown</span> -d <span class="string">'frameworkId=475189a7-dcde-4859-9af8-6fc2e63be94e-0556'</span></span><br></pre></td></tr></table></figure>
<p>手动设置spark.app.id无效：</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/usr/install/spark/bin/spark-submit \</span></span><br><span class="line">-<span class="ruby">-master <span class="symbol">mesos:</span>/<span class="regexp">/zk:/</span><span class="regexp">/192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos</span> \</span><br><span class="line"></span>-<span class="ruby">-<span class="class"><span class="keyword">class</span> <span class="title">cn</span>.<span class="title">fraudmetrix</span>.<span class="title">pontus</span>.<span class="title">demo</span>.<span class="title">SimpleApp</span> \</span></span><br><span class="line"></span>-<span class="ruby">-conf <span class="string">"spark.app.id=SimpleApp"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.app.logfile=<span class="string">"/user/qihuang.zheng/hello.txt"</span> \</span><br><span class="line"></span><span class="comment">/usr/install/pontus/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span></span><br></pre></td></tr></table></figure>
<p>序列化不适配？？ spark_2.10和2.11的版本问题？？</p>
<p>play_2.5.9不支持scal_2.10: <a href="https://www.playframework.com/documentation/2.5.x/Migration25" target="_blank" rel="external">https://www.playframework.com/documentation/2.5.x/Migration25</a><br>Play 2.3 and 2.4 supported both Scala 2.10 and 2.11. Play 2.5 has dropped support for Scala 2.10 and now only supports Scala 2.11.  </p>
<p>Jira: <a href="https://issues.apache.org/jira/browse/SPARK-13956" target="_blank" rel="external">https://issues.apache.org/jira/browse/SPARK-13956</a><br>说的是driver版本和executor版本不一致导致的。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">I1209 20:58:27.190430  3039 sched.cpp:703] Framework registered with 475189a7-dcde-4859-9af8-6fc2e63be94e-0423</span><br><span class="line">[info] p.<span class="keyword">m</span>.i.j.p.s.w.SparkJobWorker - Starting job -1651747420 future</span><br><span class="line">[Stage 0:&gt;                                                          (0 + 0) / 2][<span class="keyword">error</span>] o.a.s.<span class="keyword">n</span>.s.TransportRequestHandler - <span class="keyword">Error</span> <span class="keyword">while</span> invoking RpcHandler#receive() <span class="keyword">on</span> RPC id 8897300371223004861</span><br><span class="line">java.io.InvalidClassException: org.apache.spark.rpc.netty.RequestMessage; <span class="keyword">local</span> <span class="keyword">class</span> incompatible: stream classdesc serialVersionUID = -2221986757032131007, <span class="keyword">local</span> <span class="keyword">class</span> serialVersionUID = -5447855329526097695</span><br><span class="line">  at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:616)</span><br><span class="line">  at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1623)</span><br><span class="line">  at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)</span><br><span class="line">  at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)</span><br><span class="line">  at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)</span><br><span class="line">  at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)</span><br><span class="line">  at org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.<span class="keyword">scala</span>:76)</span><br><span class="line">  at org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.<span class="keyword">scala</span>:109)</span><br><span class="line">  at org.apache.spark.rpc.netty.NettyRpcEnv$<span class="label">$anonfun</span><span class="label">$deserialize</span><span class="label">$1</span>$<span class="label">$anonfun</span><span class="label">$apply</span><span class="label">$1</span>.apply(NettyRpcEnv.<span class="keyword">scala</span>:258)</span><br><span class="line">  at <span class="keyword">scala</span>.util.DynamicVariable.withValue(DynamicVariable.<span class="keyword">scala</span>:58)</span><br><span class="line">[<span class="keyword">error</span>] o.a.s.<span class="keyword">n</span>.s.TransportRequestHandler - <span class="keyword">Error</span> <span class="keyword">while</span> invoking RpcHandler#receive() <span class="keyword">on</span> RPC id 9207561725902043069</span><br><span class="line">java.io.InvalidClassException: org.apache.spark.rpc.netty.RequestMessage; <span class="keyword">local</span> <span class="keyword">class</span> incompatible: stream classdesc serialVersionUID = -2221986757032131007, <span class="keyword">local</span> <span class="keyword">class</span> serialVersionUID = -5447855329526097695</span><br><span class="line">  at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:616)</span><br><span class="line">  at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1623)</span><br><span class="line">  at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)</span><br><span class="line">  at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)</span><br><span class="line">  at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)</span><br><span class="line">  at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)</span><br><span class="line">  at org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.<span class="keyword">scala</span>:76)</span><br><span class="line">  at org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.<span class="keyword">scala</span>:109)</span><br><span class="line">  at org.apache.spark.rpc.netty.NettyRpcEnv$<span class="label">$anonfun</span><span class="label">$deserialize</span><span class="label">$1</span>$<span class="label">$anonfun</span><span class="label">$apply</span><span class="label">$1</span>.apply(NettyRpcEnv.<span class="keyword">scala</span>:258)</span><br><span class="line">  at <span class="keyword">scala</span>.util.DynamicVariable.withValue(DynamicVariable.<span class="keyword">scala</span>:58)</span><br><span class="line">[warn] o.a.s.s.TaskSchedulerImpl - Initial job has not accepted any resources; check your <span class="keyword">cluster</span> UI to ensure that workers are registered and have sufficient resources</span><br><span class="line">[<span class="keyword">error</span>] application -</span><br><span class="line"></span><br><span class="line">! @72b33a0kb - Internal server <span class="keyword">error</span>, <span class="keyword">for</span> (GET) [/spark] -&gt;</span><br><span class="line"></span><br><span class="line">play.api.UnexpectedException: Unexpected exception[TimeoutException: Futures timed <span class="keyword">out</span> after [30 seconds]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.<span class="keyword">scala</span>:276)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.<span class="keyword">scala</span>:206)</span><br><span class="line">  at play.api.GlobalSettings<span class="label">$class</span>.onError(GlobalSettings.<span class="keyword">scala</span>:160)</span><br><span class="line">  at util.<span class="keyword">Global</span>$.onError(<span class="keyword">Global</span>.<span class="keyword">scala</span>:22)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.<span class="keyword">scala</span>:98)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="label">$anonfun</span><span class="label">$2</span>$<span class="label">$anonfun</span><span class="label">$apply</span><span class="label">$1</span>.applyOrElse(PlayRequestHandler.<span class="keyword">scala</span>:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="label">$anonfun</span><span class="label">$2</span>$<span class="label">$anonfun</span><span class="label">$apply</span><span class="label">$1</span>.applyOrElse(PlayRequestHandler.<span class="keyword">scala</span>:99)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.Future$<span class="label">$anonfun</span><span class="label">$recoverWith</span><span class="label">$1</span>.apply(Future.<span class="keyword">scala</span>:344)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.Future$<span class="label">$anonfun</span><span class="label">$recoverWith</span><span class="label">$1</span>.apply(Future.<span class="keyword">scala</span>:343)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.impl.CallbackRunnable.<span class="keyword">run</span>(Promise.<span class="keyword">scala</span>:32)</span><br><span class="line">Caused <span class="keyword">by</span>: java.util.concurrent.TimeoutException: Futures timed <span class="keyword">out</span> after [30 seconds]</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.impl.Promise<span class="label">$DefaultPromise</span>.ready(Promise.<span class="keyword">scala</span>:219)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.impl.Promise<span class="label">$DefaultPromise</span>.result(Promise.<span class="keyword">scala</span>:223)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.Await$<span class="label">$anonfun</span><span class="label">$result</span><span class="label">$1</span>.apply(package.<span class="keyword">scala</span>:190)</span><br><span class="line">  at akka.dispatch.MonitorableThreadFactory<span class="label">$AkkaForkJoinWorkerThread</span>$<span class="label">$anon</span><span class="label">$3</span>.block(ThreadPoolBuilder.<span class="keyword">scala</span>:167)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.forkjoin.ForkJoinPool.managedBlock(ForkJoinPool.java:3640)</span><br><span class="line">  at akka.dispatch.MonitorableThreadFactory<span class="label">$AkkaForkJoinWorkerThread</span>.blockOn(ThreadPoolBuilder.<span class="keyword">scala</span>:165)</span><br><span class="line">  at akka.dispatch.BatchingExecutor<span class="label">$BlockableBatch</span>.blockOn(BatchingExecutor.<span class="keyword">scala</span>:106)</span><br><span class="line">  at <span class="keyword">scala</span>.concurrent.Await$.result(package.<span class="keyword">scala</span>:190)</span><br><span class="line">  at controllers.SparkController$<span class="label">$anonfun</span><span class="label">$sparkJob</span><span class="label">$1</span>.apply(SparkController.<span class="keyword">scala</span>:56)</span><br><span class="line">  at controllers.SparkController$<span class="label">$anonfun</span><span class="label">$sparkJob</span><span class="label">$1</span>.apply(SparkController.<span class="keyword">scala</span>:42)</span><br><span class="line">[warn] o.a.s.s.TaskSchedulerImpl - Initial job has not accepted any resources; check your <span class="keyword">cluster</span> UI to ensure that workers are registered and have sufficient resources</span><br></pre></td></tr></table></figure>
<p>把spark-core打包方式改为provided是不行的。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.NoClassDefFoundError</span>: org/apache/spark/Logging</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.defineClass1</span>(Native Method)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.defineClass</span>(ClassLoader<span class="class">.java</span>:<span class="number">760</span>)</span><br><span class="line">  at java<span class="class">.security</span><span class="class">.SecureClassLoader</span><span class="class">.defineClass</span>(SecureClassLoader<span class="class">.java</span>:<span class="number">142</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span><span class="class">.defineClass</span>(URLClassLoader<span class="class">.java</span>:<span class="number">467</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span><span class="class">.access</span>$<span class="number">100</span>(URLClassLoader<span class="class">.java</span>:<span class="number">73</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span>$<span class="number">1</span>.<span class="function"><span class="title">run</span><span class="params">(URLClassLoader.java:<span class="number">368</span>)</span></span></span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span>$<span class="number">1</span>.<span class="function"><span class="title">run</span><span class="params">(URLClassLoader.java:<span class="number">362</span>)</span></span></span><br><span class="line">  at java<span class="class">.security</span><span class="class">.AccessController</span><span class="class">.doPrivileged</span>(Native Method)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span><span class="class">.findClass</span>(URLClassLoader<span class="class">.java</span>:<span class="number">361</span>)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.loadClass</span>(ClassLoader<span class="class">.java</span>:<span class="number">424</span>)</span><br><span class="line">  at sun<span class="class">.misc</span><span class="class">.Launcher</span><span class="variable">$AppClassLoader</span>.<span class="function"><span class="title">loadClass</span><span class="params">(Launcher.java:<span class="number">331</span>)</span></span></span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.loadClass</span>(ClassLoader<span class="class">.java</span>:<span class="number">357</span>)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Class</span><span class="class">.getDeclaredConstructors0</span>(Native Method)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Class</span><span class="class">.privateGetDeclaredConstructors</span>(Class<span class="class">.java</span>:<span class="number">2671</span>)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Class</span><span class="class">.getDeclaredConstructors</span>(Class<span class="class">.java</span>:<span class="number">2020</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.spi</span><span class="class">.InjectionPoint</span><span class="class">.forConstructorOf</span>(InjectionPoint<span class="class">.java</span>:<span class="number">245</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorBindingImpl</span><span class="class">.create</span>(ConstructorBindingImpl<span class="class">.java</span>:<span class="number">99</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.createUninitializedBinding</span>(InjectorImpl<span class="class">.java</span>:<span class="number">658</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.createJustInTimeBinding</span>(InjectorImpl<span class="class">.java</span>:<span class="number">882</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.createJustInTimeBindingRecursive</span>(InjectorImpl<span class="class">.java</span>:<span class="number">805</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getJustInTimeBinding</span>(InjectorImpl<span class="class">.java</span>:<span class="number">282</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getBindingOrThrow</span>(InjectorImpl<span class="class">.java</span>:<span class="number">214</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getProviderOrThrow</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1006</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getProvider</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1038</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getProvider</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1001</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.getInstance</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1051</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.guice</span><span class="class">.GuiceInjector</span><span class="class">.instanceOf</span>(GuiceInjectorBuilder<span class="class">.scala</span>:<span class="number">405</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.RoutesProvider</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>.<span class="function"><span class="title">apply</span><span class="params">(BuiltinModule.scala:<span class="number">82</span>)</span></span></span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.RoutesProvider</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>.<span class="function"><span class="title">apply</span><span class="params">(BuiltinModule.scala:<span class="number">82</span>)</span></span></span><br><span class="line">  at scala<span class="class">.Option</span><span class="class">.fold</span>(Option<span class="class">.scala</span>:<span class="number">158</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.RoutesProvider</span><span class="class">.get</span><span class="variable">$lzycompute</span>(BuiltinModule<span class="class">.scala</span>:<span class="number">82</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.RoutesProvider</span><span class="class">.get</span>(BuiltinModule<span class="class">.scala</span>:<span class="number">78</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.RoutesProvider</span><span class="class">.get</span>(BuiltinModule<span class="class">.scala</span>:<span class="number">77</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ProviderInternalFactory</span><span class="class">.provision</span>(ProviderInternalFactory<span class="class">.java</span>:<span class="number">81</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.BoundProviderFactory</span><span class="class">.provision</span>(BoundProviderFactory<span class="class">.java</span>:<span class="number">72</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ProviderInternalFactory</span><span class="class">.circularGet</span>(ProviderInternalFactory<span class="class">.java</span>:<span class="number">61</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.BoundProviderFactory</span><span class="class">.get</span>(BoundProviderFactory<span class="class">.java</span>:<span class="number">62</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.SingleParameterInjector</span><span class="class">.inject</span>(SingleParameterInjector<span class="class">.java</span>:<span class="number">38</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.SingleParameterInjector</span><span class="class">.getAll</span>(SingleParameterInjector<span class="class">.java</span>:<span class="number">62</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorInjector</span><span class="class">.provision</span>(ConstructorInjector<span class="class">.java</span>:<span class="number">104</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorInjector</span><span class="class">.construct</span>(ConstructorInjector<span class="class">.java</span>:<span class="number">85</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorBindingImpl</span><span class="variable">$Factory</span>.<span class="function"><span class="title">get</span><span class="params">(ConstructorBindingImpl.java:<span class="number">267</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.FactoryProxy</span><span class="class">.get</span>(FactoryProxy<span class="class">.java</span>:<span class="number">56</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.SingleParameterInjector</span><span class="class">.inject</span>(SingleParameterInjector<span class="class">.java</span>:<span class="number">38</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.SingleParameterInjector</span><span class="class">.getAll</span>(SingleParameterInjector<span class="class">.java</span>:<span class="number">62</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorInjector</span><span class="class">.provision</span>(ConstructorInjector<span class="class">.java</span>:<span class="number">104</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorInjector</span><span class="class">.construct</span>(ConstructorInjector<span class="class">.java</span>:<span class="number">85</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ConstructorBindingImpl</span><span class="variable">$Factory</span>.<span class="function"><span class="title">get</span><span class="params">(ConstructorBindingImpl.java:<span class="number">267</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ProviderToInternalFactoryAdapter</span>$<span class="number">1</span>.<span class="function"><span class="title">call</span><span class="params">(ProviderToInternalFactoryAdapter.java:<span class="number">46</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.callInContext</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1103</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.ProviderToInternalFactoryAdapter</span><span class="class">.get</span>(ProviderToInternalFactoryAdapter<span class="class">.java</span>:<span class="number">40</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.SingletonScope</span>$<span class="number">1</span>.<span class="function"><span class="title">get</span><span class="params">(SingletonScope.java:<span class="number">145</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalFactoryToProviderAdapter</span><span class="class">.get</span>(InternalFactoryToProviderAdapter<span class="class">.java</span>:<span class="number">41</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.FactoryProxy</span><span class="class">.get</span>(FactoryProxy<span class="class">.java</span>:<span class="number">56</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalInjectorCreator</span>$<span class="number">1</span>.<span class="function"><span class="title">call</span><span class="params">(InternalInjectorCreator.java:<span class="number">205</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalInjectorCreator</span>$<span class="number">1</span>.<span class="function"><span class="title">call</span><span class="params">(InternalInjectorCreator.java:<span class="number">199</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InjectorImpl</span><span class="class">.callInContext</span>(InjectorImpl<span class="class">.java</span>:<span class="number">1092</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalInjectorCreator</span><span class="class">.loadEagerSingletons</span>(InternalInjectorCreator<span class="class">.java</span>:<span class="number">199</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalInjectorCreator</span><span class="class">.injectDynamically</span>(InternalInjectorCreator<span class="class">.java</span>:<span class="number">180</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.internal</span><span class="class">.InternalInjectorCreator</span><span class="class">.build</span>(InternalInjectorCreator<span class="class">.java</span>:<span class="number">110</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.Guice</span><span class="class">.createInjector</span>(Guice<span class="class">.java</span>:<span class="number">96</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.inject</span><span class="class">.Guice</span><span class="class">.createInjector</span>(Guice<span class="class">.java</span>:<span class="number">84</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.guice</span><span class="class">.GuiceBuilder</span><span class="class">.injector</span>(GuiceInjectorBuilder<span class="class">.scala</span>:<span class="number">181</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.guice</span><span class="class">.GuiceApplicationBuilder</span><span class="class">.build</span>(GuiceApplicationBuilder<span class="class">.scala</span>:<span class="number">123</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.inject</span><span class="class">.guice</span><span class="class">.GuiceApplicationLoader</span><span class="class">.load</span>(GuiceApplicationLoader<span class="class">.scala</span>:<span class="number">21</span>)</span><br><span class="line">  at play<span class="class">.core</span><span class="class">.server</span><span class="class">.ProdServerStart</span>$.<span class="function"><span class="title">start</span><span class="params">(ProdServerStart.scala:<span class="number">47</span>)</span></span></span><br><span class="line">  at play<span class="class">.core</span><span class="class">.server</span><span class="class">.ProdServerStart</span>$.<span class="function"><span class="title">main</span><span class="params">(ProdServerStart.scala:<span class="number">22</span>)</span></span></span><br><span class="line">  at play<span class="class">.core</span><span class="class">.server</span><span class="class">.ProdServerStart</span><span class="class">.main</span>(ProdServerStart.scala)</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.ClassNotFoundException</span>: org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.Logging</span></span><br><span class="line">  at java<span class="class">.net</span><span class="class">.URLClassLoader</span><span class="class">.findClass</span>(URLClassLoader<span class="class">.java</span>:<span class="number">381</span>)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.loadClass</span>(ClassLoader<span class="class">.java</span>:<span class="number">424</span>)</span><br><span class="line">  at sun<span class="class">.misc</span><span class="class">.Launcher</span><span class="variable">$AppClassLoader</span>.<span class="function"><span class="title">loadClass</span><span class="params">(Launcher.java:<span class="number">331</span>)</span></span></span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.ClassLoader</span><span class="class">.loadClass</span>(ClassLoader<span class="class">.java</span>:<span class="number">357</span>)</span><br><span class="line">  ... <span class="number">68</span> more</span><br></pre></td></tr></table></figure>
<p>在pontus-web中直接运行Spark作业</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">! @<span class="number">72</span>ck129fb - Internal server error, <span class="keyword">for</span> (GET) [/preview/HDFS/activity] -&gt;</span><br><span class="line"></span><br><span class="line">play.api.UnexpectedException: Unexpected exception[RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:<span class="number">289</span>)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">220</span>)</span><br><span class="line">  at play.api.GlobalSettings<span class="variable">$class</span>.onError(GlobalSettings.scala:<span class="number">160</span>)</span><br><span class="line">  at util.Global$.onError(Global.scala:<span class="number">20</span>)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">99</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">344</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">343</span>)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:<span class="number">32</span>)</span><br><span class="line">Caused by: java.lang.RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;</span><br><span class="line">  at play.api.mvc.ActionBuilder$<span class="variable">$anon</span><span class="variable">$2</span>.apply(Action.scala:<span class="number">463</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$5</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$6</span>.apply(Action.scala:<span class="number">112</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$5</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$6</span>.apply(Action.scala:<span class="number">112</span>)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:<span class="number">21</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$5</span>.apply(Action.scala:<span class="number">111</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$5</span>.apply(Action.scala:<span class="number">110</span>)</span><br><span class="line">  at scala.Option.<span class="keyword">map</span>(Option.scala:<span class="number">146</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>.apply(Action.scala:<span class="number">110</span>)</span><br><span class="line">  at play.api.mvc.Action$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>.apply(Action.scala:<span class="number">103</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$flatMap</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">251</span>)</span><br><span class="line">Caused by: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;</span><br><span class="line">  at akka.remote.RemoteActorRefProvider.&lt;init&gt;(RemoteActorRefProvider.scala:<span class="number">128</span>)</span><br><span class="line">  at sun.reflect.NativeConstructorAccessorImpl.newInstance<span class="number">0</span>(Native Method)</span><br><span class="line">  at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">  at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">  at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">422</span>)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$<span class="variable">$anonfun</span><span class="variable">$createInstanceFor</span><span class="variable">$2</span>.apply(ReflectiveDynamicAccess.scala:<span class="number">32</span>)</span><br><span class="line">  at scala.util.Try$.apply(Try.scala:<span class="number">192</span>)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess.createInstanceFor(ReflectiveDynamicAccess.scala:<span class="number">27</span>)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$<span class="variable">$anonfun</span><span class="variable">$createInstanceFor</span><span class="variable">$3</span>.apply(ReflectiveDynamicAccess.scala:<span class="number">38</span>)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$<span class="variable">$anonfun</span><span class="variable">$createInstanceFor</span><span class="variable">$3</span>.apply(ReflectiveDynamicAccess.scala:<span class="number">38</span>)</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/40883978/migration-to-play-2-5-leads-to-this-error-nosuchmethoderror-akka-actor-locala" target="_blank" rel="external">http://stackoverflow.com/questions/40883978/migration-to-play-2-5-leads-to-this-error-nosuchmethoderror-akka-actor-locala</a>  </p>
<p>监听器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssc.sparkContext.addSparkListener(new SparkListener()&#123;</span><br><span class="line">  override <span class="function"><span class="keyword">def</span> <span class="title">onJobEnd</span><span class="params">(jobEnd: SparkListenerJobEnd)</span>:</span> Unit = &#123;&#125;</span><br><span class="line">  override <span class="function"><span class="keyword">def</span> <span class="title">onApplicationEnd</span><span class="params">(applicationEnd: SparkListenerApplicationEnd)</span>:</span> Unit = &#123;</span><br><span class="line">    println(<span class="string">"PontusKafka2HDFSJobHandler onApplicationEnd...."</span>)</span><br><span class="line">    PontusExecutionDao.updateStatus(conf)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用命令行测试，当关闭程序后，会打印onApplicationEnd事件。在mesos上使用kill driver直接杀死应用程序，也会调用监听器的方法</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@712: Client environment:zookeeper.version=zookeeper C client 3.4.5</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@716: Client environment:host.name=dp0653</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@723: Client environment:os.name=Linux</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@724: Client environment:os.arch=<span class="number">3.10.97-1</span>.el6.elrepo.x86_64</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@725: Client environment:os.version=#1 SMP Sat Feb <span class="number">20 11:55:29</span> EST 2016</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@733: Client environment:user.name=qihuang.zheng</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@741: Client environment:user.home=/home/qihuang.zheng</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@log_env@753: Client environment:user.dir=/home/qihuang.zheng</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">4:41791(0</span>x<span class="number">2b1d28803</span>700):ZOO_INFO@zookeeper_init@786: Initiating client connection, host=<span class="number">192.168.6.55</span>:<span class="number">2181,192.168</span>.<span class="number">6.56:2181</span>,<span class="number">192.168.6.57</span>:2181 sessionTimeout=10000 watcher=<span class="number">0x2b1d00</span>0e1645 sessionId=0 sessionPasswd=&lt;null&gt; context=<span class="number">0x2b1d44</span>000960 flags=0</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,53</span><span class="number">5:41791(0</span>x<span class="number">2b1d2950</span>a700):ZOO_INFO@check_events@1703: initiated connection to server [<span class="number">192.168.6.57</span>:2181]</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.536334</span> 42031 sched.cpp:222] Version: 0.28.2</span><br><span class="line"><span class="number">2016-12-13</span> <span class="number">11:34:45,55</span><span class="number">5:41791(0</span>x<span class="number">2b1d2950</span>a700):ZOO_INFO@check_events@1750: session establishment complete on server [<span class="number">192.168.6.57</span>:2181], sessionId=<span class="number">0x3589e76</span>ef2f82e0, negotiated timeout=10000</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.556421</span> 42015 group.cpp:349] Group process (group(1)@<span class="number">192.168.6.53</span>:45534) connected to ZooKeeper</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.556823</span> 42015 group.cpp:831] Syncing group operations: queue size (joins, cancels, datas) = (0, 0, 0)</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.556903</span> 42015 group.cpp:427] Trying to create path '/mesos' in ZooKeeper</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.561131 42</span>008 detector.cpp:152] Detected a new leader: (id='70')</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.561971</span> 42011 group.cpp:700] Trying to get '/mesos/json.info_<span class="number">0000000070</span>' in ZooKeeper</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.565317</span> 42023 detector.cpp:479] <span class="keyword">A</span> new leading master (UPID=master@<span class="number">192.168.6.52</span>:5050) is detected</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.565773</span> 42026 sched.cpp:326] New master detected at master@<span class="number">192.168.6.52</span>:5050</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.567448</span> 42026 sched.cpp:336] No credentials provided. Attempting to register without authentication</span><br><span class="line">I<span class="number">1213 11:34</span>:<span class="number">45.574049</span> 42026 sched.cpp:703] Framework registered with <span class="number">475189a7</span>-dcde-4859-9af8-6fc2e63be94e-0558</span><br><span class="line"></span><br><span class="line">^CPontusKafka2HDFSJobHandler onApplicationEnd....</span><br><span class="line">I<span class="number">1213 11:42</span>:<span class="number">21.526136</span>  4384 sched.cpp:1911] Asked to stop the driver</span><br><span class="line">I<span class="number">1213 11:42</span>:<span class="number">21.526562</span> 42020 sched.cpp:1143] Stopping framework '<span class="number">475189a7</span>-dcde-4859-9af8-6fc2e63be94e-0558'</span><br></pre></td></tr></table></figure>
<h2 id="Spark_Cassandra">Spark Cassandra</h2><p>IDE中直接运行，spark依赖包不能为provided，否则找不到Spark的相关包，运行正常</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-core_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-sql_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-hive_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用maven-assembly-plugin插件打包运行，spark环境使用本地安装，scope=provide</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-core_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-sql_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spark-hive_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>打包，并用完整的依赖包执行spark-submit</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mvn clean <span class="keyword">package</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">/Users/</span>zhengqh<span class="regexp">/Soft/</span>spark-<span class="number">1.6</span>.<span class="number">2</span>-bin-hadoop2.<span class="number">6</span><span class="regexp">/bin/</span>spark-submit \</span><br><span class="line">--master <span class="string">"local[2]"</span> \</span><br><span class="line">--<span class="keyword">class</span> cn.fraudmetrix.pontus.demo.CassandraReadWrite \</span><br><span class="line"><span class="regexp">/Users/</span>zhengqh<span class="regexp">/Github/</span>vulcan<span class="regexp">/pontus-spark/</span>target<span class="regexp">/pontus-spark-1.0.0-SNAPSHOT-jar-with-dependencies.jar</span></span><br></pre></td></tr></table></figure>
<p>报错guava版本不对，即使手动加上guava版本也报错：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com<span class="class">.google</span><span class="class">.guava</span>&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">19.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.ExceptionInInitializerError</span></span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.DefaultConnectionFactory</span>$.<span class="function"><span class="title">clusterBuilder</span><span class="params">(CassandraConnectionFactory.scala:<span class="number">35</span>)</span></span></span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.DefaultConnectionFactory</span>$.<span class="function"><span class="title">createCluster</span><span class="params">(CassandraConnectionFactory.scala:<span class="number">87</span>)</span></span></span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.CassandraConnector</span>$.com<span class="variable">$datastax</span><span class="variable">$spark</span><span class="variable">$connector</span><span class="variable">$cql</span><span class="variable">$CassandraConnector</span>$<span class="variable">$createSession</span>(CassandraConnector<span class="class">.scala</span>:<span class="number">153</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.CassandraConnector</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>.<span class="function"><span class="title">apply</span><span class="params">(CassandraConnector.scala:<span class="number">148</span>)</span></span></span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.CassandraConnector</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>.<span class="function"><span class="title">apply</span><span class="params">(CassandraConnector.scala:<span class="number">148</span>)</span></span></span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.RefCountedCache</span><span class="class">.createNewValueAndKeys</span>(RefCountedCache<span class="class">.scala</span>:<span class="number">31</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.RefCountedCache</span><span class="class">.acquire</span>(RefCountedCache<span class="class">.scala</span>:<span class="number">56</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.CassandraConnector</span><span class="class">.openSession</span>(CassandraConnector<span class="class">.scala</span>:<span class="number">81</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.spark</span><span class="class">.connector</span><span class="class">.cql</span><span class="class">.CassandraConnector</span><span class="class">.withSessionDo</span>(CassandraConnector<span class="class">.scala</span>:<span class="number">109</span>)</span><br><span class="line">  at cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.demo</span><span class="class">.CassandraReadWrite</span>$.cn<span class="variable">$fraudmetrix</span><span class="variable">$pontus</span><span class="variable">$demo</span><span class="variable">$CassandraReadWrite</span>$<span class="variable">$executeCommand</span>(CassandraReadWrite<span class="class">.scala</span>:<span class="number">45</span>)</span><br><span class="line">  at cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.demo</span><span class="class">.CassandraReadWrite</span><span class="variable">$delayedInit</span><span class="variable">$body</span>.<span class="function"><span class="title">apply</span><span class="params">(CassandraReadWrite.scala:<span class="number">53</span>)</span></span></span><br><span class="line">  at scala.Function0<span class="variable">$class</span>.apply<span class="variable">$mcV</span><span class="variable">$sp</span>(Function0<span class="class">.scala</span>:<span class="number">40</span>)</span><br><span class="line">  at scala<span class="class">.runtime</span><span class="class">.AbstractFunction0</span><span class="class">.apply</span><span class="variable">$mcV</span><span class="variable">$sp</span>(AbstractFunction0<span class="class">.scala</span>:<span class="number">12</span>)</span><br><span class="line">  at scala.App$<span class="variable">$anonfun</span><span class="variable">$main</span>$<span class="number">1</span>.<span class="function"><span class="title">apply</span><span class="params">(App.scala:<span class="number">71</span>)</span></span></span><br><span class="line">  at scala.App$<span class="variable">$anonfun</span><span class="variable">$main</span>$<span class="number">1</span>.<span class="function"><span class="title">apply</span><span class="params">(App.scala:<span class="number">71</span>)</span></span></span><br><span class="line">  at scala<span class="class">.collection</span><span class="class">.immutable</span><span class="class">.List</span><span class="class">.foreach</span>(List<span class="class">.scala</span>:<span class="number">318</span>)</span><br><span class="line">  at scala<span class="class">.collection</span><span class="class">.generic</span><span class="class">.TraversableForwarder</span><span class="variable">$class</span>.<span class="function"><span class="title">foreach</span><span class="params">(TraversableForwarder.scala:<span class="number">32</span>)</span></span></span><br><span class="line">  at scala.App<span class="variable">$class</span>.<span class="function"><span class="title">main</span><span class="params">(App.scala:<span class="number">71</span>)</span></span></span><br><span class="line">  at cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.demo</span><span class="class">.CassandraReadWrite</span>$.<span class="function"><span class="title">main</span><span class="params">(CassandraReadWrite.scala:<span class="number">36</span>)</span></span></span><br><span class="line">  at cn<span class="class">.fraudmetrix</span><span class="class">.pontus</span><span class="class">.demo</span><span class="class">.CassandraReadWrite</span><span class="class">.main</span>(CassandraReadWrite.scala)</span><br><span class="line">  at sun<span class="class">.reflect</span><span class="class">.NativeMethodAccessorImpl</span><span class="class">.invoke0</span>(Native Method)</span><br><span class="line">  at sun<span class="class">.reflect</span><span class="class">.NativeMethodAccessorImpl</span><span class="class">.invoke</span>(NativeMethodAccessorImpl<span class="class">.java</span>:<span class="number">62</span>)</span><br><span class="line">  at sun<span class="class">.reflect</span><span class="class">.DelegatingMethodAccessorImpl</span><span class="class">.invoke</span>(DelegatingMethodAccessorImpl<span class="class">.java</span>:<span class="number">43</span>)</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.reflect</span><span class="class">.Method</span><span class="class">.invoke</span>(Method<span class="class">.java</span>:<span class="number">497</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.deploy</span><span class="class">.SparkSubmit</span>$.org<span class="variable">$apache</span><span class="variable">$spark</span><span class="variable">$deploy</span><span class="variable">$SparkSubmit</span>$<span class="variable">$runMain</span>(SparkSubmit<span class="class">.scala</span>:<span class="number">731</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.deploy</span><span class="class">.SparkSubmit</span>$.doRunMain$<span class="number">1</span>(SparkSubmit<span class="class">.scala</span>:<span class="number">181</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.deploy</span><span class="class">.SparkSubmit</span>$.<span class="function"><span class="title">submit</span><span class="params">(SparkSubmit.scala:<span class="number">206</span>)</span></span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.deploy</span><span class="class">.SparkSubmit</span>$.<span class="function"><span class="title">main</span><span class="params">(SparkSubmit.scala:<span class="number">121</span>)</span></span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.spark</span><span class="class">.deploy</span><span class="class">.SparkSubmit</span><span class="class">.main</span>(SparkSubmit.scala)</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.IllegalStateException</span>: Detected Guava issue <span class="hexcolor">#163</span>5 which indicates that <span class="tag">a</span> version of Guava less than <span class="number">16.01</span> is <span class="keyword">in</span> use.  This introduces codec resolution issues and potentially other incompatibility issues <span class="keyword">in</span> the driver.  Please upgrade to Guava <span class="number">16.01</span> or later.</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.SanityChecks</span><span class="class">.checkGuava</span>(SanityChecks<span class="class">.java</span>:<span class="number">62</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.SanityChecks</span><span class="class">.check</span>(SanityChecks<span class="class">.java</span>:<span class="number">36</span>)</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.Cluster</span>.&lt;clinit&gt;(Cluster<span class="class">.java</span>:<span class="number">67</span>)</span><br><span class="line">  ... <span class="number">29</span> more</span><br></pre></td></tr></table></figure>
<p>参考：<a href="http://stackoverflow.com/questions/36877897/detected-guava-issue-1635-which-indicates-that-a-version-of-guava-less-than-16" target="_blank" rel="external">http://stackoverflow.com/questions/36877897/detected-guava-issue-1635-which-indicates-that-a-version-of-guava-less-than-16</a><br>添加maven-shade-plugin插件，重新打包，除了其他包，还会生成fat包，并用fat包运行，最后正常</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ll target</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zhengqh  staff    <span class="number">14</span>M <span class="number">11</span> <span class="number">24</span> <span class="number">19</span>:<span class="number">17</span> pontus-spark-<span class="number">1.0</span><span class="number">.0</span>-SNAPSHOT-fat.jar</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zhengqh  staff    <span class="number">19</span>M <span class="number">11</span> <span class="number">24</span> <span class="number">19</span>:<span class="number">15</span> pontus-spark-<span class="number">1.0</span><span class="number">.0</span>-SNAPSHOT-jar-with-dependencies.jar</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zhengqh  staff    <span class="number">14</span>K <span class="number">11</span> <span class="number">24</span> <span class="number">19</span>:<span class="number">15</span> pontus-spark-<span class="number">1.0</span><span class="number">.0</span>-SNAPSHOT-sources.jar</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zhengqh  staff    <span class="number">94</span>K <span class="number">11</span> <span class="number">24</span> <span class="number">19</span>:<span class="number">15</span> pontus-spark-<span class="number">1.0</span><span class="number">.0</span>-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">/Users/zhengqh/Soft/spark-<span class="number">1.6</span><span class="number">.2</span>-bin-hadoop2<span class="number">.6</span>/bin/spark-submit \</span><br><span class="line">--master <span class="string">"local[2]"</span> \</span><br><span class="line">--<span class="keyword">class</span> cn.fraudmetrix.pontus.demo.CassandraReadWrite \</span><br><span class="line">/Users/zhengqh/Github/vulcan/pontus-spark/target/pontus-spark-<span class="number">1.0</span><span class="number">.0</span>-SNAPSHOT-fat.jar</span><br></pre></td></tr></table></figure>
<p>测试读取Cassandra写入到HDFS是否正确（需要启动本地dfs和Cassandra）</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/Users/zhengqh/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit \</span></span><br><span class="line">-<span class="ruby">-master <span class="string">"local[2]"</span> \</span><br><span class="line"></span>-<span class="ruby">-<span class="class"><span class="keyword">class</span> <span class="title">cn</span>.<span class="title">fraudmetrix</span>.<span class="title">pontus</span>.<span class="title">cassandra</span>.<span class="title">PontusCassandra2HDFSJobHandler</span> \</span></span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.destTable=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.tableId=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.destType=<span class="string">"HDFS"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.destUsername=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.creator=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.sourceUri=<span class="string">"localhost/demo"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.sourcePassword=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.sourceTable=<span class="string">"sales"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.sourceType=<span class="string">"Cassandra"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.readMode=<span class="string">"1"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.tableTs=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.destUri=<span class="string">"hdfs://localhost:9000/test"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.name=<span class="string">"cassandra-hdfs"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.destPassword=<span class="string">""</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.id=<span class="string">"1"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.writeMode=<span class="string">"1"</span> \</span><br><span class="line"></span>-<span class="ruby">-conf spark.pontus.sourceUsername=<span class="string">""</span> \</span><br><span class="line"></span><span class="comment">/Users/zhengqh/Github/vulcan/pontus-spark/target/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span></span><br><span class="line"></span><br><span class="line">16/11/24 19:19:16 INFO DAGScheduler: Job 0 finished: show at PontusCassandra2HDFSJobHandler.scala:42, took 4.044479 s</span><br><span class="line">+---------+--------+-----+</span><br><span class="line">|   center|products|total|</span><br><span class="line">+---------+--------+-----+</span><br><span class="line">|  Sevilla|      28| 3200|</span><br><span class="line">| Valencia|      23| 3300|</span><br><span class="line">|   Bilbao|      25| 2500|</span><br><span class="line">|   Madrid|      51| 7700|</span><br><span class="line">|Barcelona|      47| 6400|</span><br><span class="line">+---------+--------+-----+</span><br></pre></td></tr></table></figure>
<p>上面的Spark作业会将Parquet文件写入HDFS的根路径，可以用spark-shell测试读取parquet文件。</p>
<p>Spark作业执行页面：</p>
<p><img src="http://img.blog.csdn.net/20161125100527204" alt="pontus-spark"></p>
<p>Pontus作业执行成功页面：</p>
<p><img src="http://img.blog.csdn.net/20161125100553908" alt="pontus-job"></p>
<p>HDFS追加作业：</p>
<p><img src="http://img.blog.csdn.net/20161129174641219" alt="hdfs"></p>
<p>空值问题：解决办法：Option</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$<span class="variable">$anon</span><span class="variable">$1</span>: Execution exception[[RuntimeException: ColumnName(PONTUS_EXECUTION.LOGOUT,Some(LOGOUT))]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:<span class="number">293</span>)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">220</span>)</span><br><span class="line">  at play.api.GlobalSettings<span class="variable">$class</span>.onError(GlobalSettings.scala:<span class="number">160</span>)</span><br><span class="line">  at util.Global$.onError(Global.scala:<span class="number">8</span>)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">100</span>)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$<span class="variable">$anonfun</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$1</span>.applyOrElse(PlayRequestHandler.scala:<span class="number">99</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">344</span>)</span><br><span class="line">  at scala.concurrent.Future$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span><span class="variable">$1</span>.apply(Future.scala:<span class="number">343</span>)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:<span class="number">32</span>)</span><br><span class="line">Caused by: java.lang.RuntimeException: ColumnName(PONTUS_EXECUTION.LOGOUT,Some(LOGOUT))</span><br><span class="line">  at scala.sys.package$.error(package.scala:<span class="number">27</span>)</span><br><span class="line">  at anorm.SqlRequestError<span class="variable">$class</span>.toFailure(Anorm.scala:<span class="number">20</span>)</span><br><span class="line">  at anorm.UnexpectedNullableFound.toFailure(Anorm.scala:<span class="number">37</span>)</span><br><span class="line">  at anorm.Sql$<span class="variable">$anonfun</span><span class="variable">$asTry</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$7</span>.apply(Anorm.scala:<span class="number">303</span>)</span><br><span class="line">  at anorm.Sql$<span class="variable">$anonfun</span><span class="variable">$asTry</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$7</span>.apply(Anorm.scala:<span class="number">303</span>)</span><br><span class="line">  at anorm.SqlResult<span class="variable">$class</span>.fold(SqlResult.scala:<span class="number">23</span>)</span><br><span class="line">  at anorm.Error.fold(SqlResult.scala:<span class="number">31</span>)</span><br><span class="line">  at anorm.Sql$<span class="variable">$anonfun</span><span class="variable">$asTry</span><span class="variable">$2</span>.apply(Anorm.scala:<span class="number">303</span>)</span><br><span class="line">  at anorm.Sql$<span class="variable">$anonfun</span><span class="variable">$asTry</span><span class="variable">$2</span>.apply(Anorm.scala:<span class="number">303</span>)</span><br><span class="line">  at scala.util.Success.flatMap(Try.scala:<span class="number">231</span>)</span><br></pre></td></tr></table></figure>
<h2 id="预览">预览</h2><p><a href="http://192.168.6.53:9000/preview/HDFS/%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="external">http://192.168.6.53:9000/preview/HDFS/%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<p><a href="http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2F192.168.6.52:9000%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="external">http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2F192.168.6.52:9000%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<p><a href="http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2Ftdfs%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="external">http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2Ftdfs%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<h2 id="Actor">Actor</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SparkJobActor <span class="function"><span class="title">preStart</span><span class="params">()</span></span>.............</span><br><span class="line"><span class="function"><span class="title">PontusSchedule</span><span class="params">(<span class="number">1</span>,<span class="number">1</span>,qihuang.zheng,<span class="number">2016</span>-<span class="number">11</span>-<span class="number">29</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">00.0</span>,<span class="number">5</span>d)</span></span></span><br><span class="line">[warn] o<span class="class">.a</span><span class="class">.h</span><span class="class">.u</span><span class="class">.NativeCodeLoader</span> - Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line">Global <span class="function"><span class="title">onStart</span><span class="params">()</span></span>.............</span><br><span class="line">mode:demo</span><br><span class="line"><span class="function"><span class="title">PontusSchedule</span><span class="params">(<span class="number">1</span>,<span class="number">1</span>,qihuang.zheng,<span class="number">2016</span>-<span class="number">11</span>-<span class="number">29</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">00.0</span>,<span class="number">5</span>d)</span></span></span><br><span class="line">[info] play<span class="class">.api</span><span class="class">.Play</span> - Application started (Dev)</span><br></pre></td></tr></table></figure>
<h2 id="Quartz">Quartz</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.JobBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.TriggerBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.SimpleScheduleBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.CronScheduleBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.CalendarIntervalScheduleBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.JobKey</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.TriggerKey</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.DateBuilder</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.impl</span><span class="class">.matchers</span><span class="class">.KeyMatcher</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.impl</span><span class="class">.matchers</span><span class="class">.GroupMatcher</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.impl</span><span class="class">.matchers</span><span class="class">.AndMatcher</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.impl</span><span class="class">.matchers</span><span class="class">.OrMatcher</span><span class="class">._</span></span><br><span class="line"><span class="tag">import</span> <span class="tag">org</span><span class="class">.quartz</span><span class="class">.impl</span><span class="class">.matchers</span><span class="class">.EverythingMatcher</span><span class="class">._</span></span><br></pre></td></tr></table></figure>
<h3 id="Job依赖注入">Job依赖注入</h3><p>Job注入其他实例报错无法实例化，那么如何注入DAO对象？</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">PontusSparkJob</span> @<span class="type">Inject</span><span class="container">()</span><span class="container">(<span class="title">configuration</span>: <span class="type">Configuration</span>,</span><br><span class="line">                               <span class="title">executionRepository</span>: <span class="type">ExecutionRepository</span>,</span><br><span class="line">                               <span class="title">scheduleRepository</span>: <span class="type">ScheduleRepository</span>,</span><br><span class="line">                               <span class="title">jobRepository</span>: <span class="type">JobRepository</span></span><br><span class="line">                              )</span> extends <span class="type">Job</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[error] o.q.c.<span class="type">ErrorLogger</span> - <span class="type">An</span> error occured instantiating job to be executed. job= '<span class="type">Cassandra</span>.pontusjob_1'</span><br><span class="line">org.quartz.<span class="type">SchedulerException</span>: <span class="type">Problem</span> instantiating <span class="keyword">class</span> 'schedule.<span class="type">PontusSparkJob'</span></span><br><span class="line">  at org.quartz.simpl.<span class="type">SimpleJobFactory</span>.newJob<span class="container">(<span class="type">SimpleJobFactory</span>.<span class="title">java</span>:58)</span></span><br><span class="line">  at org.quartz.simpl.<span class="type">PropertySettingJobFactory</span>.newJob<span class="container">(<span class="type">PropertySettingJobFactory</span>.<span class="title">java</span>:69)</span></span><br><span class="line">  at org.quartz.core.<span class="type">JobRunShell</span>.initialize<span class="container">(<span class="type">JobRunShell</span>.<span class="title">java</span>:127)</span></span><br><span class="line">  at org.quartz.core.<span class="type">QuartzSchedulerThread</span>.run<span class="container">(<span class="type">QuartzSchedulerThread</span>.<span class="title">java</span>:375)</span></span><br><span class="line"><span class="type">Caused</span> by: java.lang.<span class="type">InstantiationException</span>: schedule.<span class="type">PontusSparkJob</span></span><br><span class="line">  at java.lang.<span class="type">Class</span>.newInstance<span class="container">(<span class="type">Class</span>.<span class="title">java</span>:427)</span></span><br><span class="line">  at org.quartz.simpl.<span class="type">SimpleJobFactory</span>.newJob<span class="container">(<span class="type">SimpleJobFactory</span>.<span class="title">java</span>:56)</span></span><br><span class="line">  ... 3 common frames omitted</span><br><span class="line"><span class="type">Caused</span> by: java.lang.<span class="type">NoSuchMethodException</span>: schedule.<span class="type">PontusSparkJob</span>.&lt;init&gt;<span class="container">()</span></span><br><span class="line">  at java.lang.<span class="type">Class</span>.getConstructor0<span class="container">(<span class="type">Class</span>.<span class="title">java</span>:3082)</span></span><br><span class="line">  at java.lang.<span class="type">Class</span>.newInstance<span class="container">(<span class="type">Class</span>.<span class="title">java</span>:412)</span></span><br><span class="line">  ... 4 common frames omitted</span></span><br></pre></td></tr></table></figure>
<p>解决办法：启动时通过Global注册Application实例，在Job中通过Scheduler获取</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Global</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">GlobalSettings</span> &#123;</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onStart</span>(</span>application: play.api.<span class="type">Application</span>) &#123;</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.start()</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.getContext.put(<span class="string">"configuration"</span>, application.configuration)</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.getContext.put(<span class="string">"application"</span>, application)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PontusSparkJob</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Job</span> &#123;</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(</span>context: <span class="type">JobExecutionContext</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> application = context.getScheduler.getContext.get(<span class="string">"application"</span>).asInstanceOf[<span class="type">Application</span>]</span><br><span class="line">    <span class="keyword">val</span> configuration = context.getScheduler.getContext.get(<span class="string">"configuration"</span>).asInstanceOf[<span class="type">Configuration</span>]</span><br><span class="line">    <span class="keyword">val</span> jobRepository = application.injector.instanceOf(classOf[<span class="type">JobRepository</span>])</span><br><span class="line">    <span class="keyword">val</span> executionRepository = application.injector.instanceOf(classOf[<span class="type">ExecutionRepository</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> jobId = context.getMergedJobDataMap.getString(<span class="string">"jobId"</span>).toLong</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TODO：自定义JobFactory</p>
<p>mesos任务报错，页面会显示申请不到资源：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I1205 <span class="number">15</span>:<span class="number">15</span>:<span class="number">20.217545</span> <span class="number">19517</span> exec.cpp:<span class="number">143</span>] Version: <span class="number">0.28</span>.<span class="number">2</span></span><br><span class="line">I1205 <span class="number">15</span>:<span class="number">15</span>:<span class="number">20.243422</span> <span class="number">19521</span> exec.cpp:<span class="number">217</span>] Executor registered <span class="keyword">on</span> slave <span class="number">475189</span>a7-dcde-<span class="number">4859</span>-<span class="number">9</span>af8-<span class="number">6</span>fc2e63be94e-S0</span><br><span class="line">Unrecognized VM option <span class="string">'UseCompressedStrings'</span></span><br><span class="line">Error: Could <span class="keyword">not</span> <span class="keyword">create</span> the Java <span class="keyword">Virtual</span> Machine.</span><br><span class="line">Error: A fatal exception <span class="keyword">has</span> occurred. Program will <span class="keyword">exit</span>.</span><br></pre></td></tr></table></figure>
<p>去掉spark中executor的jvm配置</p>
<h3 id="Quartz作业的自动重启">Quartz作业的自动重启</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">创建时：</span><br><span class="line"></span><br><span class="line">mysql&gt; select <span class="keyword">*</span> from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> SCHED_NAME      </span>|<span class="string"> TRIGGER_NAME </span>|<span class="string"> TRIGGER_GROUP </span>|<span class="string"> JOB_NAME    </span>|<span class="string"> JOB_GROUP </span>|<span class="string"> DESCRIPTION </span>|<span class="string"> NEXT_FIRE_TIME </span>|<span class="string"> PREV_FIRE_TIME </span>|<span class="string"> PRIORITY </span>|<span class="string"> TRIGGER_STATE </span>|<span class="string"> TRIGGER_TYPE </span>|<span class="string"> START_TIME    </span>|<span class="string"> END_TIME </span>|<span class="string"> CALENDAR_NAME </span>|<span class="string"> MISFIRE_INSTR </span>|<span class="string"> JOB_DATA </span>|</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger2_1   </span>|<span class="string"> Cassandra     </span>|<span class="string"> pontusjob_1 </span>|<span class="string"> Cassandra </span>|<span class="string"> NULL        </span>|<span class="string">  1480523100000 </span>|<span class="string">  1480519500000 </span>|<span class="string">        5 </span>|<span class="string"> WAITING       </span>|<span class="string"> SIMPLE       </span>|<span class="string"> 1480515900000 </span>|<span class="string">        0 </span>|<span class="string"> NULL          </span>|<span class="string">             1 </span>|<span class="string">          </span>|</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">1 row in set (10.33 sec)</span><br><span class="line"></span><br><span class="line">创建时间（START_TIME）：         1480515900000 - 2016年11月30日 星期三 22时25分00秒 CST</span><br><span class="line">第一次执行时间（PREV_FIRE_TIME）：1480519500000 - 2016年11月30日 星期三 23时25分00秒 CST</span><br><span class="line">下一次执行时间（NEXT_FIRE_TIME）：1480523100000 - 2016年12月 1日 星期四 00时25分00秒 CST</span><br><span class="line"></span><br><span class="line">停止服务器</span><br><span class="line"></span><br><span class="line">第二天早上重启，重启后如果没有访问页面，仍然不会调度，但是只要登录，就会开始调度</span><br><span class="line"></span><br><span class="line">mysql&gt; select <span class="keyword">*</span> from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> SCHED_NAME      </span>|<span class="string"> TRIGGER_NAME </span>|<span class="string"> TRIGGER_GROUP </span>|<span class="string"> JOB_NAME    </span>|<span class="string"> JOB_GROUP </span>|<span class="string"> DESCRIPTION </span>|<span class="string"> NEXT_FIRE_TIME </span>|<span class="string"> PREV_FIRE_TIME </span>|<span class="string"> PRIORITY </span>|<span class="string"> TRIGGER_STATE </span>|<span class="string"> TRIGGER_TYPE </span>|<span class="string"> START_TIME    </span>|<span class="string"> END_TIME </span>|<span class="string"> CALENDAR_NAME </span>|<span class="string"> MISFIRE_INSTR </span>|<span class="string"> JOB_DATA </span>|</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger2_1   </span>|<span class="string"> Cassandra     </span>|<span class="string"> pontusjob_1 </span>|<span class="string"> Cassandra </span>|<span class="string"> NULL        </span>|<span class="string">  1480561432130 </span>|<span class="string">  1480557832130 </span>|<span class="string">        5 </span>|<span class="string"> WAITING       </span>|<span class="string"> SIMPLE       </span>|<span class="string"> 1480557832130 </span>|<span class="string">        0 </span>|<span class="string"> NULL          </span>|<span class="string">             1 </span>|<span class="string">          </span>|</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">START_TIME：     1480557832130 - 2016年12月 1日 星期四 10时03分52秒 CST</span><br><span class="line">PREV_FIRE_TIME： 1480557832130 - 2016年12月 1日 星期四 10时03分52秒 CST</span><br><span class="line">NEXT_FIRE_TIME： 1480561432130 - 2016年12月 1日 星期四 11时03分52秒 CST</span><br></pre></td></tr></table></figure>
<p>相同Job不允许同时有两个Trigger在运行。解决办法：可以设置不同的JobId。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">! @<span class="number">729</span>o8hm27 - Internal server error, <span class="keyword">for</span> (GET) [/job/execute/Cassandra/HDFS/<span class="number">2</span>] -&gt;</span><br><span class="line"></span><br><span class="line">play<span class="class">.api</span><span class="class">.UnexpectedException</span>: Unexpected exception[ObjectAlreadyExistsException: Unable to store Job : <span class="string">'Cassandra-HDFS.pontusjob_2'</span>, because one already exists with this identification.]</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.http</span><span class="class">.HttpErrorHandlerExceptions</span>$.<span class="function"><span class="title">throwableToUsefulException</span><span class="params">(HttpErrorHandler.scala:<span class="number">289</span>)</span></span></span><br><span class="line">  at play<span class="class">.api</span><span class="class">.http</span><span class="class">.DefaultHttpErrorHandler</span><span class="class">.onServerError</span>(HttpErrorHandler<span class="class">.scala</span>:<span class="number">220</span>)</span><br><span class="line">  at play<span class="class">.api</span><span class="class">.GlobalSettings</span><span class="variable">$class</span>.<span class="function"><span class="title">onError</span><span class="params">(GlobalSettings.scala:<span class="number">160</span>)</span></span></span><br><span class="line">  at util.Global$.<span class="function"><span class="title">onError</span><span class="params">(Global.scala:<span class="number">23</span>)</span></span></span><br><span class="line">  at play<span class="class">.api</span><span class="class">.http</span><span class="class">.GlobalSettingsHttpErrorHandler</span><span class="class">.onServerError</span>(HttpErrorHandler<span class="class">.scala</span>:<span class="number">100</span>)</span><br><span class="line">  at play<span class="class">.core</span><span class="class">.server</span><span class="class">.netty</span><span class="class">.PlayRequestHandler</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span>$<span class="number">1</span>.<span class="function"><span class="title">applyOrElse</span><span class="params">(PlayRequestHandler.scala:<span class="number">100</span>)</span></span></span><br><span class="line">  at play<span class="class">.core</span><span class="class">.server</span><span class="class">.netty</span><span class="class">.PlayRequestHandler</span>$<span class="variable">$anonfun</span>$<span class="number">2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span>$<span class="number">1</span>.<span class="function"><span class="title">applyOrElse</span><span class="params">(PlayRequestHandler.scala:<span class="number">99</span>)</span></span></span><br><span class="line">  at scala<span class="class">.concurrent</span><span class="class">.Future</span>$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span>$<span class="number">1</span>.<span class="function"><span class="title">apply</span><span class="params">(Future.scala:<span class="number">344</span>)</span></span></span><br><span class="line">  at scala<span class="class">.concurrent</span><span class="class">.Future</span>$<span class="variable">$anonfun</span><span class="variable">$recoverWith</span>$<span class="number">1</span>.<span class="function"><span class="title">apply</span><span class="params">(Future.scala:<span class="number">343</span>)</span></span></span><br><span class="line">  at scala<span class="class">.concurrent</span><span class="class">.impl</span><span class="class">.CallbackRunnable</span><span class="class">.run</span>(Promise<span class="class">.scala</span>:<span class="number">32</span>)</span><br><span class="line">Caused by: org<span class="class">.quartz</span><span class="class">.ObjectAlreadyExistsException</span>: Unable to store Job : <span class="string">'Cassandra-HDFS.pontusjob_2'</span>, because one already exists with this identification.</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span><span class="class">.storeJob</span>(JobStoreSupport<span class="class">.java</span>:<span class="number">1108</span>)</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span>$<span class="number">2</span>.<span class="function"><span class="title">executeVoid</span><span class="params">(JobStoreSupport.java:<span class="number">1062</span>)</span></span></span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span><span class="variable">$VoidTransactionCallback</span>.<span class="function"><span class="title">execute</span><span class="params">(JobStoreSupport.java:<span class="number">3715</span>)</span></span></span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span><span class="variable">$VoidTransactionCallback</span>.<span class="function"><span class="title">execute</span><span class="params">(JobStoreSupport.java:<span class="number">3713</span>)</span></span></span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span><span class="class">.executeInNonManagedTXLock</span>(JobStoreSupport<span class="class">.java</span>:<span class="number">3799</span>)</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreTX</span><span class="class">.executeInLock</span>(JobStoreTX<span class="class">.java</span>:<span class="number">93</span>)</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.jdbcjobstore</span><span class="class">.JobStoreSupport</span><span class="class">.storeJobAndTrigger</span>(JobStoreSupport<span class="class">.java</span>:<span class="number">1058</span>)</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.core</span><span class="class">.QuartzScheduler</span><span class="class">.scheduleJob</span>(QuartzScheduler<span class="class">.java</span>:<span class="number">886</span>)</span><br><span class="line">  at org<span class="class">.quartz</span><span class="class">.impl</span><span class="class">.StdScheduler</span><span class="class">.scheduleJob</span>(StdScheduler<span class="class">.java</span>:<span class="number">249</span>)</span><br><span class="line">  at controllers.PontusJobController$<span class="variable">$anonfun</span><span class="variable">$execute</span>$<span class="number">1</span>.<span class="function"><span class="title">apply</span><span class="params">(PontusJobController.scala:<span class="number">72</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>spark streaming一次性作业：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="keyword">*</span> from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> SCHED_NAME      </span>|<span class="string"> TRIGGER_NAME </span>|<span class="string"> TRIGGER_GROUP  </span>|<span class="string"> JOB_NAME     </span>|<span class="string"> JOB_GROUP      </span>|<span class="string"> DESCRIPTION </span>|<span class="string"> NEXT_FIRE_TIME </span>|<span class="string"> PREV_FIRE_TIME </span>|<span class="string"> PRIORITY </span>|<span class="string"> TRIGGER_STATE </span>|<span class="string"> TRIGGER_TYPE </span>|<span class="string"> START_TIME    </span>|<span class="string"> END_TIME </span>|<span class="string"> CALENDAR_NAME </span>|<span class="string"> MISFIRE_INSTR </span>|<span class="string"> JOB_DATA </span>|</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger1_2   </span>|<span class="string"> Kafka-HDFS     </span>|<span class="string"> pontusjob1_2 </span>|<span class="string"> Kafka-HDFS     </span>|<span class="string"> NULL        </span>|<span class="string">             -1 </span>|<span class="string">  1481165690342 </span>|<span class="string">        5 </span>|<span class="string"> COMPLETE      </span>|<span class="string"> SIMPLE       </span>|<span class="string"> 1481165690342 </span>|<span class="string">        0 </span>|<span class="string"> NULL          </span>|<span class="string">             0 </span>|<span class="string">          </span>|</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger2_1   </span>|<span class="string"> Cassandra-HDFS </span>|<span class="string"> pontusjob2_1 </span>|<span class="string"> Cassandra-HDFS </span>|<span class="string"> NULL        </span>|<span class="string">  1481165913700 </span>|<span class="string">  1481165433700 </span>|<span class="string">        5 </span>|<span class="string"> WAITING       </span>|<span class="string"> SIMPLE       </span>|<span class="string"> 1481103993700 </span>|<span class="string">        0 </span>|<span class="string"> NULL          </span>|<span class="string">             1 </span>|<span class="string">          </span>|</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select <span class="keyword">*</span> from QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">|<span class="string"> SCHED_NAME      </span>|<span class="string"> TRIGGER_NAME </span>|<span class="string"> TRIGGER_GROUP  </span>|<span class="string"> REPEAT_COUNT </span>|<span class="string"> REPEAT_INTERVAL </span>|<span class="string"> TIMES_TRIGGERED </span>|</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger1_2   </span>|<span class="string"> Kafka-HDFS     </span>|<span class="string">            0 </span>|<span class="string">               0 </span>|<span class="string">               1 </span>|</span><br><span class="line">|<span class="string"> QuartzScheduler </span>|<span class="string"> trigger2_1   </span>|<span class="string"> Cassandra-HDFS </span>|<span class="string">           -1 </span>|<span class="string">          480000 </span>|<span class="string">             129 </span>|</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>过了会儿，一次性的任务信息会从Quartz删除，但是实际上spark streaming还在运行！<br>这时，如果再次点击执行，虽然triggerKey不存在，但是也不应该允许再次执行！否则就会存在两个spark streaming程序！<br>还有一个问题：由于spark streaming不会结束，所以无法看到日志，状态也永远是正在执行。</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">mysql&gt; select * from QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span></span><br><span class="line"><span class="header">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | REPEAT_COUNT | REPEAT_INTERVAL | TIMES_TRIGGERED |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span></span><br><span class="line"><span class="header">| QuartzScheduler | trigger2_1   | Cassandra-HDFS |           -1 |          480000 |             129 |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="header">mysql&gt; select * from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span></span><br><span class="line"><span class="header">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | JOB_NAME     | JOB_GROUP      | DESCRIPTION | NEXT_FIRE_TIME | PREV_FIRE_TIME | PRIORITY | TRIGGER_STATE | TRIGGER_TYPE | START_TIME    | END_TIME | CALENDAR_NAME | MISFIRE_INSTR | JOB_DATA |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span></span><br><span class="line"><span class="header">| QuartzScheduler | trigger2_1   | Cassandra-HDFS | pontusjob2_1 | Cassandra-HDFS | NULL        |  1481165913700 |  1481165433700 |        5 | WAITING       | SIMPLE       | 1481103993700 |        0 | NULL          |             1 |          |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h2 id="Kafka">Kafka</h2><p>创建测试主题</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper <span class="number">192.168</span><span class="number">.6</span><span class="number">.55</span>:<span class="number">2181</span> --replication-factor <span class="number">1</span> --partitions <span class="number">1</span> --topic graylog_nginx</span><br><span class="line">bin/kafka-console-producer.sh --broker-<span class="built_in">list</span> <span class="number">192.168</span><span class="number">.6</span><span class="number">.55</span>:<span class="number">9092</span>,<span class="number">192.168</span><span class="number">.6</span><span class="number">.56</span>:<span class="number">9092</span>,<span class="number">192.168</span><span class="number">.6</span><span class="number">.57</span>:<span class="number">9092</span> --topic graylog_nginx</span><br><span class="line">bin/kafka-console-consumer.sh --zookeeper <span class="number">192.168</span><span class="number">.6</span><span class="number">.55</span>:<span class="number">2181</span> --topic graylog_nginx --from-beginning</span><br></pre></td></tr></table></figure>
<p>准备json数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">1</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Betty"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"bsmithrl@simplemachines.org"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Eláteia"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Greece"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"9.19.204.44"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">2</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Anna"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"alewisrm@canalblog.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Shangjing"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"China"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"14.207.119.126"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">3</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"David"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"dgarrettrn@japanpost.jp"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Tsarychanka"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Ukraine"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"111.252.63.159"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">4</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Heather"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"hgilbertro@skype.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Koilás"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Greece"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"29.57.181.250"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">5</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Diane"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"ddanielsrp@statcounter.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Mapiripán"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Colombia"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"19.205.181.99"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">6</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Philip"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"pfullerrq@reuters.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"El Cairo"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Colombia"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"210.248.121.194"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">7</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Maria"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"mfordrr@shop-pro.jp"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Karabash"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Russia"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"224.21.41.52"</span></span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">8</span></span>,"<span class="attribute">username</span>":<span class="value"><span class="string">"Bety"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"bsmithrl@simplemachines.org"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Eláteia"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Greece"</span></span>,"<span class="attribute">ipAddress</span>":<span class="value"><span class="string">"9.19.204.44"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">9</span></span>,"<span class="attribute">username</span>":<span class="value"><span class="string">"Ana"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"alewisrm@canalblog.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Shangjing"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"China"</span></span>,"<span class="attribute">ipAddress</span>":<span class="value"><span class="string">"14.207.119.126"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">10</span></span>,"<span class="attribute">username</span>":<span class="value"><span class="string">"David"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"dgarrettrn@japanpost.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Tsarychanka"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Ukraine"</span></span>,"<span class="attribute">ipAddress</span>":<span class="value"><span class="string">"111.252.63.159"</span></span>&#125;</span><br><span class="line">&#123;"<span class="attribute">id</span>":<span class="value"><span class="number">11</span></span>,"<span class="attribute">name</span>":<span class="value"><span class="string">"Calis"</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"carlis@google.com"</span></span>,"<span class="attribute">city</span>":<span class="value"><span class="string">"Koran"</span></span>,"<span class="attribute">country</span>":<span class="value"><span class="string">"Greece"</span></span>,"<span class="attribute">ip</span>":<span class="value"><span class="string">"29.57.181.250"</span></span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="附录">附录</h1><h2 id="sbt私服">sbt私服</h2><p>安装repox：<a href="https://github.com/Centaur/repox/wiki">https://github.com/Centaur/repox/wiki</a><br>可以在本机开发环境编译jar包，再上次到服务器（因为服务器上可能没有编译所需的node环境）。  </p>
<p>启动repox，然后打开：<a href="http://192.168.6.53:8078/admin/admin.html#/upstreams" target="_blank" rel="external">http://192.168.6.53:8078/admin/admin.html#/upstreams</a>，密码：zhimakaimen</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">nohup</span> <span class="tag">java</span> <span class="tag">-Xmx512m</span> <span class="tag">-jar</span> <span class="tag">repox-assembly-0</span><span class="class">.1-SNAPSHOT</span><span class="class">.jar</span> &amp;</span><br></pre></td></tr></table></figure>
<p>在<code>~/.sbt/repositories</code>添加两行配置：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repox-maven: http://192.168.6.53:8078/</span><br><span class="line">repox-ivy: http://192.168.6.53:8078/, [<span class="link_label">organization</span>]/[<span class="link_label">module</span>]/(scala<span class="emphasis">_[scalaVersion]/)(sbt_</span>[<span class="link_label">sbtVersion</span>]/)[<span class="link_label">revision</span>]/[<span class="link_label">type</span>]s/[<span class="link_label">artifact</span>](<span class="link_url">-[classifier]</span>).[ext]</span><br></pre></td></tr></table></figure>
<p>完整的repositories文件：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[repositories]</span><br><span class="line">local</span><br><span class="line">local-maven: file:///Users/zhengqh/.m2/repository/</span><br><span class="line">repox-maven: http://192.168.6.53:8078/</span><br><span class="line">repox-ivy: http://192.168.6.53:8078/, [<span class="link_label">organization</span>]/[<span class="link_label">module</span>]/(scala<span class="emphasis">_[scalaVersion]/)(sbt_</span>[<span class="link_label">sbtVersion</span>]/)[<span class="link_label">revision</span>]/[<span class="link_label">type</span>]s/[<span class="link_label">artifact</span>](<span class="link_url">-[classifier]</span>).[ext]</span><br><span class="line"><span class="header">#osc: http://maven.oschina.net/content/groups/public/</span></span><br><span class="line"><span class="header">#oschina-ivy: http://maven.oschina.net/content/groups/public/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext]</span></span><br><span class="line">typesafe: http://repo.typesafe.com/typesafe/ivy-releases/, [<span class="link_label">organization</span>]/[<span class="link_label">module</span>]/(scala<span class="emphasis">_[scalaVersion]/)(sbt_</span>[<span class="link_label">sbtVersion</span>]/)[<span class="link_label">revision</span>]/[<span class="link_label">type</span>]s/[<span class="link_label">artifact</span>](<span class="link_url">-[classifier]</span>).[ext], bootOnly</span><br><span class="line">sonatype-oss-releases</span><br><span class="line">maven-central</span><br><span class="line">sonatype-oss-snapshots</span><br></pre></td></tr></table></figure>
<p>使用activator运行play时，创建activatorconfig.txt文件，添加以下配置：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.activator/activatorconfig<span class="class">.txt</span></span><br><span class="line">-Dsbt<span class="class">.override</span><span class="class">.build</span><span class="class">.repos</span>=true</span><br></pre></td></tr></table></figure>
<p>命令行运行activator，如果出现<code>downloading http://192.168.6.53:8078</code>，表示私服搭建成功。<br>如果本地不存在jar包，则私服会自动下载，然后再下载到本地。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  first-player git:(master) ✗ ./activator run</span><br><span class="line">[info] Loading global plugins from /Users/zhengqh/.sbt/<span class="number">0.13</span>/plugins</span><br><span class="line">[info] Loading project definition from /Users/zhengqh/Github/first-player/project</span><br><span class="line">[info] Updating &#123;file:/Users/zhengqh/Github/first-player/project/&#125;first-player-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi<span class="preprocessor">#jansi;<span class="number">1.4</span> ...</span></span><br><span class="line">[info] downloading http:<span class="comment">//192.168.6.53:8078/com.typesafe.play/sbt-plugin/scala_2.10/sbt_0.13/2.5.10/jars/sbt-plugin.jar ...</span></span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play<span class="preprocessor">#sbt-plugin;<span class="number">2.5</span><span class="number">.10</span>!sbt-plugin.jar (<span class="number">7242</span>ms)</span></span><br><span class="line">[info] downloading http:<span class="comment">//192.168.6.53:8078/com/typesafe/play/sbt-routes-compiler_2.10/2.5.10/sbt-routes-compiler_2.10-2.5.10.jar ...</span></span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play<span class="preprocessor">#sbt-routes-compiler_2<span class="number">.10</span>;<span class="number">2.5</span><span class="number">.10</span>!sbt-routes-compiler_2<span class="number">.10</span>.jar (<span class="number">9753</span>ms)</span></span><br><span class="line">[info] downloading http:<span class="comment">//192.168.6.53:8078/com/typesafe/play/sbt-run-support_2.10/2.5.10/sbt-run-support_2.10-2.5.10.jar ...</span></span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play<span class="preprocessor">#sbt-run-support_2<span class="number">.10</span>;<span class="number">2.5</span><span class="number">.10</span>!sbt-run-support_2<span class="number">.10</span>.jar (<span class="number">6686</span>ms)</span></span><br><span class="line">[info] downloading http:<span class="comment">//192.168.6.53:8078/com/typesafe/play/build-link/2.5.10/build-link-2.5.10.jar ...</span></span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play<span class="preprocessor">#build-link;<span class="number">2.5</span><span class="number">.10</span>!build-link.jar (<span class="number">6589</span>ms)</span></span><br><span class="line">[info] downloading http:<span class="comment">//192.168.6.53:8078/com/typesafe/play/play-exceptions/2.5.10/play-exceptions-2.5.10.jar ...</span></span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play<span class="preprocessor">#play-exceptions;<span class="number">2.5</span><span class="number">.10</span>!play-exceptions.jar (<span class="number">2358</span>ms)</span></span><br><span class="line">[info] Done updating.</span><br></pre></td></tr></table></figure>
<p>使用sbt运行时（sbt run），需要更改sbt的选项，比如下面是mac环境使用brew安装sbt配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/<span class="built_in">local</span>/bin/sbt</span><br><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line"><span class="built_in">export</span> SBT_OPTS=<span class="string">"-Dsbt.override.build.repos=true"</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$HOME</span>/.sbtconfig"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Use of ~/.sbtconfig is deprecated, please migrate global settings to /usr/local/etc/sbtopts"</span> &gt;&amp;<span class="number">2</span></span><br><span class="line">  . <span class="string">"<span class="variable">$HOME</span>/.sbtconfig"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"/usr/local/Cellar/sbt/0.13.8/libexec/sbt"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>
<p>IDEA开发环境，还需要配置：</p>
<p><img src="http://img.blog.csdn.net/20170512105246182" alt="3"></p>
<h2 id="Play_MultiProject">Play MultiProject</h2><p>参考：<a href="https://github.com/aaronp/multi-project">https://github.com/aaronp/multi-project</a></p>
<p>增加play后，</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: org.slf4j.helpers.NOPLoggerFactory cannot be <span class="keyword">cast</span> <span class="keyword">to</span> ch.qos.logback.classic.LoggerContext</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.configure(LogbackLoggerConfigurator.scala:<span class="number">80</span>)</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.init(LogbackLoggerConfigurator.scala:<span class="number">26</span>)</span><br><span class="line">  at play.core.server.DevServerStart$<span class="variable">$anonfun</span><span class="variable">$mainDev</span><span class="variable">$1</span>.apply(DevServerStart.scala:<span class="number">94</span>)</span><br><span class="line">  at play.core.server.DevServerStart$<span class="variable">$anonfun</span><span class="variable">$mainDev</span><span class="variable">$1</span>.apply(DevServerStart.scala:<span class="number">65</span>)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:<span class="number">21</span>)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDev(DevServerStart.scala:<span class="number">64</span>)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDevHttpMode(DevServerStart.scala:<span class="number">54</span>)</span><br><span class="line">  at play.core.server.DevServerStart.mainDevHttpMode(DevServerStart.scala)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke<span class="number">0</span>(Native Method)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">  at java.lang.reflect.Method.invoke(Method.java:<span class="number">497</span>)</span><br><span class="line">  at play.runsupport.Reloader$.startDevMode(Reloader.scala:<span class="number">207</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.devModeServer<span class="variable">$lzycompute</span><span class="variable">$1</span>(PlayRun.scala:<span class="number">73</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.play<span class="variable">$sbt</span><span class="variable">$run</span><span class="variable">$PlayRun</span>$<span class="variable">$anonfun</span>$<span class="variable">$anonfun</span>$<span class="variable">$anonfun</span>$<span class="variable">$devModeServer</span><span class="variable">$1</span>(PlayRun.scala:<span class="number">73</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.apply(PlayRun.scala:<span class="number">99</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.apply(PlayRun.scala:<span class="number">52</span>)</span><br><span class="line">  at scala.Function1$<span class="variable">$anonfun</span><span class="variable">$compose</span><span class="variable">$1</span>.apply(Function1.scala:<span class="number">47</span>)</span><br><span class="line">[trace] Stack trace suppressed: run last web/compile:run <span class="keyword">for</span> the full output.</span><br><span class="line">[error] (web/compile:run) java.lang.reflect.InvocationTargetException</span><br><span class="line">[error] Total time: <span class="number">37</span> s, completed <span class="number">2017</span>-<span class="number">3</span>-<span class="number">8</span> <span class="number">20</span>:<span class="number">28</span>:<span class="number">39</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: org.slf4j.impl.Log4jLoggerFactory cannot be <span class="keyword">cast</span> <span class="keyword">to</span> ch.qos.logback.classic.LoggerContext</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.configure(LogbackLoggerConfigurator.scala:<span class="number">80</span>)</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.init(LogbackLoggerConfigurator.scala:<span class="number">26</span>)</span><br><span class="line">  at play.core.server.DevServerStart$<span class="variable">$anonfun</span><span class="variable">$mainDev</span><span class="variable">$1</span>.apply(DevServerStart.scala:<span class="number">94</span>)</span><br><span class="line">  at play.core.server.DevServerStart$<span class="variable">$anonfun</span><span class="variable">$mainDev</span><span class="variable">$1</span>.apply(DevServerStart.scala:<span class="number">65</span>)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:<span class="number">21</span>)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDev(DevServerStart.scala:<span class="number">64</span>)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDevHttpMode(DevServerStart.scala:<span class="number">54</span>)</span><br><span class="line">  at play.core.server.DevServerStart.mainDevHttpMode(DevServerStart.scala)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke<span class="number">0</span>(Native Method)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">  at java.lang.reflect.Method.invoke(Method.java:<span class="number">497</span>)</span><br><span class="line">  at play.runsupport.Reloader$.startDevMode(Reloader.scala:<span class="number">234</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.devModeServer<span class="variable">$lzycompute</span><span class="variable">$1</span>(PlayRun.scala:<span class="number">74</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.play<span class="variable">$sbt</span><span class="variable">$run</span><span class="variable">$PlayRun</span>$<span class="variable">$anonfun</span>$<span class="variable">$anonfun</span>$<span class="variable">$anonfun</span>$<span class="variable">$devModeServer</span><span class="variable">$1</span>(PlayRun.scala:<span class="number">74</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.apply(PlayRun.scala:<span class="number">100</span>)</span><br><span class="line">  at play.sbt.run.PlayRun$<span class="variable">$anonfun</span><span class="variable">$playRunTask</span><span class="variable">$1</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$2</span>$<span class="variable">$anonfun</span><span class="variable">$apply</span><span class="variable">$3</span>.apply(PlayRun.scala:<span class="number">53</span>)</span><br><span class="line">  at scala.Function1$<span class="variable">$anonfun</span><span class="variable">$compose</span><span class="variable">$1</span>.apply(Function1.scala:<span class="number">47</span>)</span><br><span class="line">[trace] Stack trace suppressed: run last web/compile:run <span class="keyword">for</span> the full output.</span><br><span class="line">[error] (web/compile:run) java.lang.reflect.InvocationTargetException</span><br><span class="line">[error] Total time: <span class="number">3</span> s, completed <span class="number">2017</span>-<span class="number">3</span>-<span class="number">8</span> <span class="number">20</span>:<span class="number">16</span>:<span class="number">56</span></span><br></pre></td></tr></table></figure>
<p>解决方式：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val webExcludeDependencies = Seq(</span><br><span class="line">  <span class="function"><span class="title">SbtExclusionRule</span><span class="params">(<span class="string">"org.slf4j"</span> ,<span class="string">"slf4j-simple"</span>)</span></span>,</span><br><span class="line">  <span class="function"><span class="title">SbtExclusionRule</span><span class="params">(<span class="string">"org.slf4j"</span>, <span class="string">"slf4j-jdk12"</span>)</span></span> ,</span><br><span class="line">  <span class="function"><span class="title">SbtExclusionRule</span><span class="params">(<span class="string">"org.slf4j"</span>, <span class="string">"slf4j-log4j12"</span>)</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Run_&amp;_Debug_With_IDEA">Run &amp; Debug With IDEA</h2><p>参考：<a href="http://stackoverflow.com/questions/24218341/how-to-run-play-framework-2-x-in-debug-mode-in-intellij-idea" target="_blank" rel="external">http://stackoverflow.com/questions/24218341/how-to-run-play-framework-2-x-in-debug-mode-in-intellij-idea</a><br><a href="http://stackoverflow.com/questions/22195364/debugging-sbt-project-with-play-in-intellij-idea" target="_blank" rel="external">http://stackoverflow.com/questions/22195364/debugging-sbt-project-with-play-in-intellij-idea</a><br><a href="http://stackoverflow.com/questions/4150776/debugging-scala-code-with-simple-build-tool-sbt-and-intellij" target="_blank" rel="external">http://stackoverflow.com/questions/4150776/debugging-scala-code-with-simple-build-tool-sbt-and-intellij</a></p>
<p>命令行运行： <code>sbt web/run -Dconfig.resource=local/application.zqh.conf -Dhttp.port=9091</code></p>
<h3 id="1-_Play_App（❌）">1. Play App（❌）</h3><p>IDEA中运行Play App，或者直接在Controller上右键点击Run Play 2 App</p>
<p><img src="http://img.blog.csdn.net/20170512103522643" alt="1"></p>
<p>sbt多模块无法定位到web</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[info] Loading project definition <span class="keyword">from</span> /Users/zhengqh/Github/pontus/project</span><br><span class="line">[info] Updating &#123;<span class="type">file</span>:/Users/zhengqh/Github/pontus/project/&#125;pontus-build...</span><br><span class="line">[info] Compiling <span class="number">3</span> Scala sources <span class="keyword">to</span> /Users/zhengqh/Github/pontus/project/target/scala-<span class="number">2.10</span>/sbt-<span class="number">0.13</span>/classes...</span><br><span class="line">[info] Set current project <span class="keyword">to</span> pontus-root (<span class="keyword">in</span> build <span class="type">file</span>:/Users/zhengqh/Github/pontus/)</span><br><span class="line">[warn] compile:<span class="command">run</span>::javaOptions will be ignored, compile:<span class="command">run</span>::fork <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> <span class="constant">false</span></span><br><span class="line">java.lang.RuntimeException: No main <span class="type">class</span> detected.</span><br><span class="line">  <span class="keyword">at</span> scala.sys.package$.<span class="keyword">error</span>(package.scala:<span class="number">27</span>)</span><br><span class="line">[trace] Stack trace suppressed: <span class="command">run</span> '<span class="keyword">last</span> root/compile:<span class="command">run</span>' <span class="keyword">for</span> <span class="keyword">the</span> full output.</span><br><span class="line">[<span class="keyword">error</span>] (root/compile:<span class="command">run</span>) No main <span class="type">class</span> detected.</span><br><span class="line">[<span class="keyword">error</span>] Total <span class="property">time</span>: <span class="number">0</span> s, completed <span class="number">2017</span>-<span class="number">5</span>-<span class="number">12</span> <span class="number">10</span>:<span class="number">35</span>:<span class="number">01</span></span><br><span class="line">Disconnected <span class="keyword">from</span> <span class="keyword">the</span> target VM, address: '<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">62036</span>', transport: 'socket'</span><br></pre></td></tr></table></figure>
<p>只有Play工程，应该是可以的</p>
<h3 id="2-_Sbt_Task（✅）">2. Sbt Task（✅）</h3><p>IDEA中运行Sbt Task，注意-D参数必须添加到VM arguments，不能放在Tasks中</p>
<p><img src="http://img.blog.csdn.net/20170512103539643" alt="2"></p>
<h3 id="3-_jvm-debug（✅）">3. jvm-debug（✅）</h3><p>Play工程的命令行执行方式：sbt -jvm-debug 9999 “run 9091”</p>
<p>Sbt多模块的命令行执行方式：sbt -jvm-debug 9999  web/run -Dconfig.resource=local/application.zqh.conf -Dhttp.port=9091</p>
<p>先在命令行启动sbt，然后在IDEA中配置Remote</p>
<p><img src="http://img.blog.csdn.net/20170512104754468" alt="3"></p>
<p>用启动Remote的debug，设置断点，可以进入断点，控制器会打印</p>
<p>Connected to the target VM, address: ‘localhost:9999’, transport: ‘socket’</p>
<p>访问：<a href="http://localhost:9091/api/v1/job" target="_blank" rel="external">http://localhost:9091/api/v1/job</a> ，进入DEBUG模式</p>
<p><img src="http://img.blog.csdn.net/20170512105802005" alt="4"></p>

      
    </div>
    
  </div>
  
    
<div class="copyright">
  <p><span>本文标题:</span><a href="/2016/11/11/Play-Quickstart/">PlayFramework快速入门</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 任何忧伤,都抵不过世界的美丽 的个人博客">任何忧伤,都抵不过世界的美丽</a></p>
  <p><span>发布时间:</span>2016年11月11日 - 00时00分</p>
  <p><span>最后更新:</span>2017年09月01日 - 11时09分</p>
  <p>
    <span>原始链接:</span><a href="/2016/11/11/Play-Quickstart/" title="PlayFramework快速入门">http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/</a>
    <span class="btn" data-clipboard-text="原文: http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/　　作者: 任何忧伤,都抵不过世界的美丽" title="点击复制文章链接">
        <i class="fa fa-clipboard"></i>
    </span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p>
  <script src="/js/clipboard.min.js"></script>
  <script> var clipboard = new Clipboard('.btn'); </script>
</div>
<style type="text/css">
  .copyright p .btn {
    margin-left: 1em;
  }
  .copyright:hover p .btn::after {
    content: "复制"
  }
  .copyright p .btn:hover {
      color: gray;
      cursor: pointer;
    };
</style>



<nav id="article-nav">
  
    <div id="article-nav-newer" class="article-nav-title">
      <a href="/2016/11/11/Data-Transform/">
        ETL Tools
      </a>
    </div>
  
  
    <div id="article-nav-older" class="article-nav-title">
      <a href="/2016/11/06/Kafka-Streams-blog/">
        Kafka Streams 博客
      </a>
    </div>
  
</nav>

  
  
    <div class ="post-donate">
	<br/>
	<p>
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
		   这么长的文章我都读完了，看起来作者写的很辛苦哇！给作者赏杯咖啡喝，支持作者继续写作😁
        </span>
        <br>
    </div>  
	<div id="donate_guide" class="donate_bar center hidden" >
		<img src="/img/zhifubao.png" alt="支付宝打赏"> 
		<img src="/img/weixin.png" alt="微信打赏">  
    </div>
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function(){
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}
	</script>
</div>
  
</article>

<!-- 默认显示文章目录，在文章---前输入toc: false关闭目录 -->
<!-- Show TOC and tocButton in default, Hide TOC via putting "toc: false" before "---" at [post].md -->
<div id="toc" class="toc-article">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Run!_Run!!_Run!!!"><span class="toc-number">1.</span> <span class="toc-text">Run! Run!! Run!!!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hello_World!"><span class="toc-number">2.</span> <span class="toc-text">Hello World!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#路由和Controller"><span class="toc-number">2.1.</span> <span class="toc-text">路由和Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面和渲染"><span class="toc-number">2.2.</span> <span class="toc-text">页面和渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模板编译"><span class="toc-number">2.2.1.</span> <span class="toc-text">模板编译</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Products_Example"><span class="toc-number">3.</span> <span class="toc-text">Products Example</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#implicit"><span class="toc-number">3.1.</span> <span class="toc-text">implicit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spark集成"><span class="toc-number">4.</span> <span class="toc-text">Spark集成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#play-spark-module"><span class="toc-number">4.1.</span> <span class="toc-text">play-spark-module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark_Launcher"><span class="toc-number">4.2.</span> <span class="toc-text">Spark Launcher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mesos"><span class="toc-number">4.2.1.</span> <span class="toc-text">mesos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题"><span class="toc-number">4.2.2.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark_Cassandra"><span class="toc-number">4.3.</span> <span class="toc-text">Spark Cassandra</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#预览"><span class="toc-number">4.4.</span> <span class="toc-text">预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Actor"><span class="toc-number">4.5.</span> <span class="toc-text">Actor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Quartz"><span class="toc-number">4.6.</span> <span class="toc-text">Quartz</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Job依赖注入"><span class="toc-number">4.6.1.</span> <span class="toc-text">Job依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quartz作业的自动重启"><span class="toc-number">4.6.2.</span> <span class="toc-text">Quartz作业的自动重启</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka"><span class="toc-number">4.7.</span> <span class="toc-text">Kafka</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">5.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sbt私服"><span class="toc-number">5.1.</span> <span class="toc-text">sbt私服</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Play_MultiProject"><span class="toc-number">5.2.</span> <span class="toc-text">Play MultiProject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run_&_Debug_With_IDEA"><span class="toc-number">5.3.</span> <span class="toc-text">Run & Debug With IDEA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_Play_App（❌）"><span class="toc-number">5.3.1.</span> <span class="toc-text">1. Play App（❌）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_Sbt_Task（✅）"><span class="toc-number">5.3.2.</span> <span class="toc-text">2. Sbt Task（✅）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_jvm-debug（✅）"><span class="toc-number">5.3.3.</span> <span class="toc-text">3. jvm-debug（✅）</span></a></li></ol></li></ol></li></ol>
</div>
<style type="text/css">
  .left-col .switch-btn {
    display: none;
  }
  .left-col .switch-area {
    display: none;
  }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script type="text/javascript">
  var toc_button= document.getElementById("tocButton");
  var toc_div= document.getElementById("toc");
  /* Show or hide toc when click on tocButton.
  通过点击设置的按钮显示或者隐藏文章目录.*/
  toc_button.onclick=function(){
  if(toc_div.style.display=="none"){
  toc_div.style.display="block";
  toc_button.value="隐藏目录";
  document.getElementById("switch-btn").style.display="none";
  document.getElementById("switch-area").style.display="none";
  }
  else{
  toc_div.style.display="none";
  toc_button.value="显示目录";
  document.getElementById("switch-btn").style.display="block";
  document.getElementById("switch-area").style.display="block";
  }
  }
    if ($(".toc").length < 1) {
        $("#toc").css("display","none");
        $("#tocButton").css("display","none");
        $(".switch-btn").css("display","block");
        $(".switch-area").css("display","block");
    }
</script>


    <style>
        .toc {
            white-space: nowrap;
            overflow-x: hidden;
        }
    </style>

    <script>
        $(document).ready(function() {
            $(".toc li a").mouseover(function() {
                var title = $(this).attr('href');
                $(this).attr("title", title);
            });
        })
    </script>




<div class="share">
	<div class="bdsharebuttonbox">
	<a href="#" class="bds_more" data-cmd="more"></a>
	<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
	<a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
	<a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
	<a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
	</div>
	<script>
	window._bd_share_config={
		"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>
</div>



<div class="duoshuo" id="comments">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/11/11/Play-Quickstart/" data-title="PlayFramework快速入门" data-url="http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"zqhxuyuan"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






    <style type="text/css">
    #scroll {
      display: none;
    }
    </style>
    <div class="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
    </div>


  
  
    
    <div  class="post-nav-button">
    <a href="/2016/11/11/Data-Transform/" title="上一篇: ETL Tools">
    <i class="fa fa-angle-left"></i>
    </a>
    <a href="/2016/11/06/Kafka-Streams-blog/" title="下一篇: Kafka Streams 博客">
    <i class="fa fa-angle-right"></i>
    </a>
    </div>
  



    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 任何忧伤,都抵不过世界的美丽
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-80646710-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>